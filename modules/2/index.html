<!DOCTYPE html><html lang="fr"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/baja/styles.e66be5681e6c344a18d4.css" data-identity="gatsby-global-css">*{box-sizing:border-box;margin:0;padding:0}.body,.section{color:#2e2e28;font-family:Roboto Regular,sans-serif;font-size:large;font-weight:400}.section{display:flex;flex-flow:row wrap;min-height:10px;width:100%}.section__content{box-sizing:border-box;flex:1 1 100%;flex-wrap:wrap;padding-left:1rem;padding-right:1rem;padding-top:1rem}.section__content--no-auto-margin{padding-left:0}@media only screen and (min-width:992px){.section__content{flex-basis:50%}}.section__header{align-self:flex-start;flex:1 1 100%;font-family:Baloo Bhaina\ 2 Bold,sans-serif;font-size:x-large;font-weight:300;line-height:1.5rem;min-height:10px;padding-left:1rem;padding-right:1rem;text-align:center}.section__header--left{padding-left:1rem;text-align:left}.section__footer{align-self:flex-end;flex:1 1 100%;justify-content:center;min-height:5vh;padding-bottom:1rem;padding-left:1rem;padding-right:1rem;text-align:center}.section__background{background-size:cover;display:flex;flex-flow:row wrap;min-height:10px;width:100%}.section a{color:#2e2e28;cursor:pointer;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}.section a:focus,.section a:hover{color:#656558}.header--overlay{left:0;position:absolute;top:0;width:100%;z-index:10}main{background-color:#fffff5;color:#2e2e28;flex-grow:1}.footer,main{font-family:Roboto Regular,sans-serif;font-size:large;font-weight:400}.footer{background-color:#2e2e28;color:#fff}.footer__icons li:last-of-type{margin-right:0}.footer__background{align-items:center;display:flex;justify-content:space-between;min-height:8vh;padding:1rem}.footer__logo{height:100%}.footer__logo__text{color:#fff;display:inline-block;font-family:MeriendaOne,sans-serif;font-size:1.7rem;font-weight:300}.footer__logo__image{background-image:url(data:image/png;base64,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);background-position:0,100%;min-height:3rem;min-width:30vw}.footer__logo__image,.footer__logo__image2{background-repeat:no-repeat;background-size:contain;display:inline-block;margin-left:1rem;vertical-align:middle}.footer__logo__image2{background-position:50%;min-height:2rem;min-width:10vw}.master{display:flex;flex-direction:column;min-height:100vh;position:relative}.page{word-wrap:break-word;overflow-wrap:break-word;word-break:break-word}.page--auto-margin{padding:1rem}.page--auto-margin ol,.page--auto-margin ul{padding-left:1.3rem;padding-right:1.3rem}.page a{color:#2e2e28;cursor:pointer;-webkit-hyphens:auto;hyphens:auto}.page a:focus,.page a:hover{color:#656558}.page table{border-collapse:collapse;margin-top:.5rem}.page table td,.page table th{border:thin solid gray;padding:.2rem;text-align:left;vertical-align:top}.page strong{font-family:Roboto Bold}.grid{position:relative}.grid__background-image-wrapper__image{padding:0}.grid__content{display:block;left:0;position:absolute;top:0}.table{border:0;border-bottom:1px solid #ccc;border-collapse:collapse;border-spacing:2px;border-top:3px solid;color:#000;margin:2rem 0;table-layout:fixed;text-indent:0;width:100%}.table td{border:1px solid #ccc;border-bottom:0;border-left:0;border-right:0;padding:.75rem;vertical-align:top;width:75%}.table th{word-wrap:break-word;border:1px solid #ccc;border-bottom:0;border-left:0;-webkit-hyphens:auto;hyphens:auto;padding:.75rem .75rem .75rem 0;text-align:left;vertical-align:top;width:25%}.background{display:flex;z-index:0}.background__image{display:grid}.background--header{z-index:10}.menu{align-items:center;display:flex;list-style:none;margin:0;width:100%}.menu a{color:#fffff5;font-size:1.3rem}.menu a:hover{color:#fffd75;transition:color .3s ease-in}.menu li{margin-right:1rem}.card{background-color:#b54ff9;border-radius:.5rem;display:block;-webkit-hyphens:auto;hyphens:auto;margin-bottom:.5rem;padding:.5rem;width:100%;word-break:break-word}.card--fill-wrapper{height:100%}.card--dark-summary{background-color:#2e2e28;border-radius:0;color:#fffff5}.card__header{display:block;font-family:Baloo Bhaina\ 2 Bold,sans-serif;font-size:x-large;font-weight:300;line-height:1.5rem;padding:.5rem;text-align:center}.card__content{display:grid;grid-template-columns:1fr 2fr;width:100%}@media only screen and (min-width:576px){.card__content{grid-template-columns:150px 2fr}}.card__content--long-titles{grid-template-columns:2fr 1fr}@media only screen and (min-width:576px){.card__content--long-titles{grid-template-columns:2fr 150px}}.card__content--orange{color:orange!important}.card__content__title{color:#fffff5;font-weight:300;padding-bottom:.5rem;padding-right:.5rem}.card__content__description{padding-bottom:.5rem}.card__content__description a{color:#2e2e28;cursor:pointer;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}.card__content__description a:focus,.card__content__description a:hover{color:#656558}.card__content__description input{height:1.3rem;vertical-align:middle;width:1.3rem}.card__content__description__subitems{list-style:none}.card__content__description__subitems__item{border:.5px solid #fffff5;border-radius:.5rem;margin-bottom:.5rem;padding:.5rem}.card__content__description__subitems__item:last-child{margin-bottom:0}.navbar{align-items:center;background-color:#a01ef7;display:flex;flex-basis:100%;flex-wrap:wrap;font-family:MeriendaOne,sans-serif;font-size:large;font-weight:300;justify-content:space-between;margin:0;padding:1rem;position:relative;width:100%;z-index:100}@media only screen and (min-width:992px){.navbar{flex-wrap:nowrap;justify-content:flex-start}}.navbar__toggler{background-color:transparent;border:1px solid #fffff5;border-radius:.25rem;cursor:pointer;display:inline-block;font-size:1.25rem;line-height:1;padding:.25rem .75rem;transition:box-shadow .15s ease-in-out}@media only screen and (min-width:992px){.navbar__toggler{display:none}}.navbar__toggler__icon{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 30 30'%3e%3cpath stroke='hsl(59, 100%, 98%)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e")!important;background-position:50%;background-repeat:no-repeat;display:inline-block;height:1.5em;vertical-align:middle;width:1.5em}.navbar__brand{color:#fffff5;font-size:1.7rem;margin-right:1rem;padding-bottom:.3125rem;padding-top:.3125rem;text-decoration:none;white-space:nowrap}.navbar__menu{align-items:center;display:none;flex-basis:100%;flex-grow:1}.navbar__menu--collapse{display:flex}@media only screen and (min-width:992px){.navbar__menu{display:flex;flex-basis:auto}}.navbar__menu__list{display:flex;flex-direction:column;list-style:none}@media only screen and (min-width:992px){.navbar__menu__list{flex-direction:row}}.navbar__menu__list__item{display:list-item;padding-bottom:.5rem;padding-top:.5rem;position:relative}@media only screen and (min-width:992px){.navbar__menu__list__item{padding-left:.5rem;padding-right:.5rem}}.navbar__menu__list__item__link{color:#fffff5;cursor:pointer;display:block;text-decoration:none;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}.navbar__menu__list__item__link:focus,.navbar__menu__list__item__link:hover{color:#fffd8f}.navbar__menu__list__item__link--dropdown-toggle:after{border-bottom:0;border-left:.3em solid transparent;border-right:.3em solid transparent;border-top:.3em solid;content:"";display:inline-block;margin-left:.255em;vertical-align:.255em}.navbar__menu__list__item__dropdown-menu{background-clip:padding-box;background-color:#fffff5;border:1px solid #2e2e28;border-radius:.25rem;color:#2e2e28;display:none;left:0;list-style:none;margin-top:.125rem;min-width:10rem;padding:.5rem 0;position:static;text-align:left;top:100%;z-index:1000}@media only screen and (min-width:992px){.navbar__menu__list__item__dropdown-menu{position:absolute}}.navbar__menu__list__item__dropdown-menu--collapsed{display:block}.navbar__menu__list__item__dropdown-menu__item{display:list-item;padding:.5rem;position:relative}.navbar__menu__list__item__dropdown-menu__item:focus,.navbar__menu__list__item__dropdown-menu__item:hover{background-color:#e0e0dc}.navbar__menu__list__item__dropdown-menu__item__link{color:#2e2e28;cursor:pointer;display:block;text-decoration:none;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}.navbar__menu__list__item__dropdown-menu__item__link:focus,.navbar__menu__list__item__dropdown-menu__item__link:hover{color:#656558}@media only screen and (min-width:992px){.navbar{display:flex;flex-basis:auto}}.navbar--transparent-background{background-color:transparent;background-image:none}.navbar--top-of-page{left:0;position:absolute;top:0}.carousel__wrapper{background-color:#a01ef7;background-image:linear-gradient(180deg,#a01ef7 25%,#ca80fb);box-sizing:border-box;height:auto;margin-top:1rem;max-width:100%;width:100%}.carousel__wrapper__background{display:block}.carousel__wrapper__background--transparent{background-color:transparent;background-image:none}.quote{display:flex;height:100%;justify-content:center;max-width:100vw;padding:30px 20px 60px;width:100%}.quote--close-to-others{padding-bottom:1rem;padding-top:0}.quote__content{align-self:flex-start;border-bottom:1px solid;border-top:1px solid;color:#fffff5;padding:30px 0;position:relative}.quote__content--dark-and-wide{color:#2e2e28;padding:30px 0;width:100%}.quote__content h3{color:#fffff5;position:relative}.quote__content h4{color:#2e2e28;margin:0;padding-top:20px;position:relative}.quote__content h4:before{content:"— "}.quote__content:after{bottom:-43px;color:#fffff5;content:"”";font-size:10rem;line-height:0;position:absolute;right:30px}.schedule{color:#2e2e28;display:flex;flex-direction:column;font-family:Roboto Regular,sans-serif;font-size:large;font-weight:400;gap:.5rem;width:100%}.schedule__header1,.schedule__header2,.schedule__header3,.schedule__header4{display:block;font-family:Baloo Bhaina\ 2 Bold,sans-serif;font-size:x-large;font-size:large;font-weight:300;line-height:1.5rem;text-align:left}.schedule__title{display:block;font-family:Baloo Bhaina\ 2 Bold,sans-serif;font-size:x-large;font-size:medium;font-weight:300;line-height:1.5rem}.schedule__title1:not(.schedule__title),.schedule__title2:not(.schedule__title),.schedule__title3:not(.schedule__title),.schedule__title4:not(.schedule__title){display:none}.schedule__session{background-color:#b54ff9;border-radius:.5rem;display:flex;flex-direction:row;flex-wrap:wrap;min-height:5rem;padding:.5rem;width:100%}.schedule__session__title{align-self:flex-start;color:#fffff5;font-weight:700;text-align:center;width:100%}.schedule__session__time{align-self:flex-end;font-weight:700;text-align:center;width:100%}@media only screen and (min-width:576px){.schedule{color:#2e2e28;display:grid;font-family:Roboto Regular,sans-serif;font-size:large;font-weight:400;grid-template:"headertitle header1 header2  header3  header4" "scheduletitle1 monday1 wednesday1 thursday1 friday1" "scheduletitle2 monday2 wednesday2 thursday2 friday2" "scheduletitle3 monday3 wednesday3 thursday3 friday3" "scheduletitle4 monday4 wednesday4 thursday4 friday4";grid-template-columns:repeat(5,1fr);width:100%}.schedule__title1{display:block;font-size:large;grid-area:scheduletitle1}.schedule__title2{display:block;font-size:large;grid-area:scheduletitle2}.schedule__title3{display:block;font-size:large;grid-area:scheduletitle3}.schedule__title4{display:block;font-size:large;grid-area:scheduletitle4}.schedule__header1{grid-area:header1;text-align:center}.schedule__header2{grid-area:header2;text-align:center}.schedule__header3{grid-area:header3;text-align:center}.schedule__header4{grid-area:header4;text-align:center}.schedule__monday1{grid-area:monday1}.schedule__monday2{grid-area:monday2}.schedule__monday3{grid-area:monday3}.schedule__monday4{grid-area:monday4}.schedule__wednesday1{grid-area:wednesday1}.schedule__wednesday2{grid-area:wednesday2}.schedule__wednesday3{grid-area:wednesday3}.schedule__wednesday4{grid-area:wednesday4}.schedule__thursday1{grid-area:thursday1}.schedule__thursday2{grid-area:thursday2}.schedule__thursday3{grid-area:thursday3}.schedule__thursday4{grid-area:thursday4}.schedule__friday1{grid-area:friday1}.schedule__friday2{grid-area:friday2}.schedule__friday3{grid-area:friday3}.schedule__friday4{grid-area:friday4}.schedule__title:not(.schedule__title1):not(.schedule__title2):not(.schedule__title3):not(.schedule__title4){display:none}}.list{padding-left:1rem;padding-top:1rem}.index{grid-gap:1rem;display:grid;grid-template-columns:1fr}@media only screen and (min-width:576px){.index{grid-template-columns:1fr 1fr}}@media only screen and (min-width:1200px){.index{grid-template-columns:1fr 1fr 1fr}}.index__search{display:block;grid-column-end:-1;grid-column-start:1;margin-bottom:1rem;margin-top:1rem;padding:.5rem;width:100%}.index__button{background-color:#2e2e28;border:none;border-radius:.25rem;color:#fffff5;cursor:pointer;display:inline-block;margin-top:1rem;padding:.375rem .75rem;text-align:center;vertical-align:middle}.index__button:hover{background-color:#4a4a40}.index__card{background-color:#b54ff9;border-radius:.5rem;display:block;-webkit-hyphens:auto;hyphens:auto;padding:.5rem;width:100%;word-break:break-word}.index__card__header{display:block;font-family:Baloo Bhaina\ 2 Bold,sans-serif;font-size:x-large;font-weight:300;line-height:1.5rem;padding:.5rem;text-align:center}.index__card__content{display:grid;grid-template-columns:1fr 2fr;width:100%}.index__card__content__title{color:#fffff5;font-weight:300;padding-bottom:.5rem;padding-right:.5rem}.index__card__content__description{padding-bottom:.5rem}.index__card__content__description a{color:#2e2e28;cursor:pointer;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}.index__card__content__description a:focus,.index__card__content__description a:hover{color:#656558}.index__card__content__description input{height:1.3rem;vertical-align:middle;width:1.3rem}.index__card__content__description__subitems{list-style:none}.index__card__content__description__subitems__item{border:.5px solid #fffff5;border-radius:.5rem;margin-bottom:.5rem;padding:.5rem}.index__card__content__description__subitems__item:last-child{margin-bottom:0}.index__card__content__description--is-being-edited{background-color:#fffff5;margin-bottom:.5rem;padding:.3rem}.index__card__content__description--is-inline{display:inline-block}.index__card--is-being-edited{animation:gradient 2s linear infinite;animation-direction:alternate;background:linear-gradient(45deg,#a01ef7,#8e1ef7,#7c1ef7,#6a1ef7,#581ef7,#461ef7);background-size:600% 100%}@keyframes gradient{0%{background-position:0}to{background-position:100%}}.index .fa-plus-circle{margin-right:.5rem}.index .fa-check-circle{color:green;font-size:1.5rem}.index .fa-minus-circle,.index .fa-times-circle{color:red;font-size:1.5rem}.index .fa-comment-dots,.index .fa-edit,.index .fa-eye,.index .fa-save,.index .fa-times,.index .fa-trash-alt,.index .fa-user-plus,.index .fa-user-times{cursor:pointer;margin-bottom:.5rem;margin-right:.5rem}.index .fa-comment-dots:hover,.index .fa-edit:hover,.index .fa-eye:hover,.index .fa-save:hover,.index .fa-times:hover,.index .fa-trash-alt:hover,.index .fa-user-plus:hover,.index .fa-user-times:hover{color:#4a4a40}.index--long-text{grid-column-end:-1;grid-column-start:1}@media only screen and (min-width:576px){.index--long-text .index__card__content{grid-template-columns:200px 1fr!important}}.spinner__overlay{background:rgba(0,0,0,.7);bottom:0;left:0;position:fixed;right:0;top:0;z-index:5}.spinner__animation{color:#a01ef7;left:50%;position:fixed;top:50%;transform:translate(-50%,-50%);z-index:10}.summary{grid-gap:1rem;display:grid;grid-template-columns:1fr;padding-top:1rem}@media only screen and (min-width:576px){.summary{grid-template-columns:1fr 1fr}}.summary__card-wrapper{display:block;width:100%}.summary__card-wrapper:only-child{grid-column-end:-1;grid-column-start:1;margin-left:auto;margin-right:auto;width:100%}@media only screen and (min-width:576px){.summary__card-wrapper:only-child{width:50%}}@media only screen and (min-width:1200px){.summary__card-wrapper:only-child{width:33%}}.summary .fa-comment,.summary .fa-heart{margin-right:.5rem}.summary .fa-heart{color:red}.summary .fa-comment{color:green}.counter{background-color:#2e2e28;display:flex;justify-content:space-evenly;padding-bottom:.5rem;padding-top:.5rem}.counter__symbol{margin-right:.2rem}.counter__symbol--red{color:red}.counter__symbol--orange{color:orange}.counter__symbol--green{color:green}.codeblock{margin-bottom:.5rem;margin-top:.5rem;overflow:auto}.codeblock pre[class*=language-]{float:left;min-width:100%;padding:.5rem}.codeblock__header{border-bottom:thin solid #9acd32;display:flex;justify-content:flex-start;margin-bottom:.5rem;padding-bottom:.3rem;padding-top:.3rem}.codeblock__header__copy-button{background:none;border:none;color:#fff;cursor:pointer;padding-right:1rem}.codeblock__header__language-name{color:#9acd32}.codeblock__body__line{display:block;min-width:100%}.codeblock__body__line--highlighted{background-color:#353b45}.codeblock__body__line__number{display:table-cell;opacity:.5;-webkit-user-select:none;user-select:none;width:2.5rem}.codeblock__body__line__content{display:table-cell}.scrollable-image{overflow:auto}.scrollable-image__wrapper{display:inline-block;width:100%}@font-face{font-display:swap;font-family:Kavoon;src:url(/baja/static/Kavoon-Regular-942c5ec99a683f33cbd21f88d0c771dc.ttf)}@font-face{font-display:swap;font-family:MeriendaOne;font-size:15vh;src:url(/baja/static/MeriendaOne-Regular-e9c591ea2539ec7dc624851057cb737b.ttf)}@font-face{font-display:swap;font-family:Apercu Pro Regular;src:url("/baja/static/Apercu Pro Regular-c90f8890213c974793f9a1f665d86410.otf")}@font-face{font-display:swap;font-family:Roboto Regular;src:url(/baja/static/Roboto-Regular-a8d6ac03c7b96b7acb6228ff2676139d.ttf)}@font-face{font-display:swap;font-family:Roboto Bold;src:url(/baja/static/Roboto-Bold-f80816a5455d171f948d98c32f20c46e.ttf)}@font-face{font-display:swap;font-family:Baloo Bhaina\ 2 Bold;src:url(/baja/static/BalooBhaina2-Bold-0c4963b78753a15075509a388f17234e.ttf)}h1{color:#2e2e28;font-family:Baloo Bhaina\ 2 Bold,sans-serif;font-size:xx-large;font-weight:300;line-height:2rem}h2,h3{font-family:Baloo Bhaina\ 2 Bold,sans-serif;font-size:x-large;font-weight:300;line-height:1.7rem}.text,h2,h3{color:#2e2e28}.text{font-family:Roboto Regular,sans-serif;font-size:large;font-weight:400}.text--light{color:#fffff5!important}.text--italic{font-style:italic!important}.text--emphasized{font-family:Baloo Bhaina\ 2 Bold,sans-serif;font-size:x-large;font-weight:300;line-height:1.5rem}.text--hand-written{font-family:MeriendaOne,sans-serif;font-size:large;font-weight:300}.ml-0{margin-left:0!important}.ml-1{margin-left:.25rem!important}.ml-2{margin-left:.5rem!important}.ml-3{margin-left:1rem!important}.ml-4{margin-left:1.5rem!important}.ml-5{margin-left:3rem!important}.mt-0{margin-top:0!important}.mt-1{margin-top:.25rem!important}.mt-2{margin-top:.5rem!important}.mt-3{margin-top:1rem!important}.mt-4{margin-top:1.5rem!important}.mt-5{margin-top:3rem!important}.mb-0{margin-bottom:0!important}.mb-1{margin-bottom:.25rem!important}.mb-2{margin-bottom:.5rem!important}.mb-3{margin-bottom:1rem!important}.mb-4{margin-bottom:1.5rem!important}.mb-5{margin-bottom:3rem!important}.mr-0{margin-right:0!important}.mr-1{margin-right:.25rem!important}.mr-2{margin-right:.5rem!important}.mr-3{margin-right:1rem!important}.mr-4{margin-right:1.5rem!important}.mr-5{margin-right:3rem!important}.pl-0{padding-left:0!important}.pl-1{padding-left:.25rem!important}.pl-2{padding-left:.5rem!important}.pl-3{padding-left:1rem!important}.pl-4{padding-left:1.5rem!important}.pl-5{padding-left:3rem!important}.pt-0{padding-top:0!important}.pt-1{padding-top:.25rem!important}.pt-2{padding-top:.5rem!important}.pt-3{padding-top:1rem!important}.pt-4{padding-top:1.5rem!important}.pt-5{padding-top:3rem!important}.pb-0{padding-bottom:0!important}.pb-1{padding-bottom:.25rem!important}.pb-2{padding-bottom:.5rem!important}.pb-3{padding-bottom:1rem!important}.pb-4{padding-bottom:1.5rem!important}.pb-5{padding-bottom:3rem!important}.pr-0{padding-right:0!important}.pr-1{padding-right:.25rem!important}.pr-2{padding-right:.5rem!important}.pr-3{padding-right:1rem!important}.pr-4{padding-right:1.5rem!important}.pr-5{padding-right:3rem!important}.vh-5{height:5vh}.vh-10{height:10vh}.vh-15{height:15vh}.vh-20{height:20vh}.vh-25{height:25vh}.vh-30{height:30vh}.vh-35{height:35vh}.vh-40{height:40vh}.vh-45{height:45vh}.vh-50{height:50vh}.vh-55{height:55vh}.vh-60{height:60vh}.vh-65{height:65vh}.vh-70{height:70vh}.vh-75{height:75vh}.vh-80{height:80vh}.vh-85{height:85vh}.vh-90{height:90vh}.vh-95{height:95vh}.vh-100{height:100vh}.vw-5{flex-basis:5vw;width:5vw}.vw-10{flex-basis:10vw;width:10vw}.vw-15{flex-basis:15vw;width:15vw}.vw-20{flex-basis:20vw;width:20vw}.vw-25{flex-basis:25vw;width:25vw}.vw-30{flex-basis:30vw;width:30vw}.vw-35{flex-basis:35vw;width:35vw}.vw-40{flex-basis:40vw;width:40vw}.vw-45{flex-basis:45vw;width:45vw}.vw-50{flex-basis:50vw;width:50vw}.vw-55{flex-basis:55vw;width:55vw}.vw-60{flex-basis:60vw;width:60vw}.vw-65{flex-basis:65vw;width:65vw}.vw-70{flex-basis:70vw;width:70vw}.vw-75{flex-basis:75vw;width:75vw}.vw-80{flex-basis:80vw;width:80vw}.vw-85{flex-basis:85vw;width:85vw}.vw-90{flex-basis:90vw;width:90vw}.vw-95{flex-basis:95vw;width:95vw}.vw-100{flex-basis:100vw;width:100vw}.w-5{flex-basis:5%;width:5%}.w-10{flex-basis:10%;width:10%}.w-15{flex-basis:15%;width:15%}.w-20{flex-basis:20%;width:20%}.w-25{flex-basis:25%;width:25%}.w-30{flex-basis:30%;width:30%}.w-35{flex-basis:35%;width:35%}.w-40{flex-basis:40%;width:40%}.w-45{flex-basis:45%;width:45%}.w-50{flex-basis:50%;width:50%}.w-55{flex-basis:55%;width:55%}.w-60{flex-basis:60%;width:60%}.w-65{flex-basis:65%;width:65%}.w-70{flex-basis:70%;width:70%}.w-75{flex-basis:75%;width:75%}.w-80{flex-basis:80%;width:80%}.w-85{flex-basis:85%;width:85%}.w-90{flex-basis:90%;width:90%}.w-95{flex-basis:95%;width:95%}.w-100{flex-basis:100%;width:100%}.svg-inline--fa,svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;-webkit-box-sizing:border-box;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;line-height:inherit;position:absolute;text-align:center;width:2em}.fa-border{border:.08em solid #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s linear infinite;animation:fa-spin 2s linear infinite}.fa-pulse{-webkit-animation:fa-spin 1s steps(8) infinite;animation:fa-spin 1s steps(8) infinite}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.fa-rotate-90{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";-webkit-transform:scaleX(-1);transform:scaleX(-1)}.fa-flip-vertical{-webkit-transform:scaleY(-1);transform:scaleY(-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical,.fa-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)"}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1);transform:scale(-1)}:root .fa-flip-both,:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{clip:rect(0,0,0,0);border:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}.svg-inline--fa .fa-primary{fill:var(--fa-primary-color,currentColor);opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa .fa-secondary{fill:var(--fa-secondary-color,currentColor)}.svg-inline--fa .fa-secondary,.svg-inline--fa.fa-swap-opacity .fa-primary{opacity:.4;opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-secondary{opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa mask .fa-primary,.svg-inline--fa mask .fa-secondary{fill:#000}.fad.fa-inverse{color:#fff}</style><meta name="generator" content="Gatsby 3.15.0"/><title data-react-helmet="true">Module 2 : JAX-RS &amp; auths</title><meta data-react-helmet="true" name="description" content="Authentification &amp; autorisation au sein de JAX-RS"/><meta data-react-helmet="true" property="og:url" content="https://e-vinci.github.io/baja/baja/modules/2/"/><meta data-react-helmet="true" property="og:title" content="Module 2 : JAX-RS &amp; auths"/><meta data-react-helmet="true" property="og:description" content="Authentification &amp; autorisation au sein de JAX-RS"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/baja/favicon-32x32.png" type="image/png"/><link rel="icon" href="/baja/favicon.svg" type="image/svg+xml"/><link rel="manifest" href="/baja/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#303030"/><link rel="apple-touch-icon" sizes="48x48" href="/baja/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/baja/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/baja/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/baja/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/baja/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/baja/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/baja/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/baja/icons/icon-512x512.png"/><link as="script" rel="preload" href="/baja/webpack-runtime-1a988f899203af32e814.js"/><link as="script" rel="preload" href="/baja/framework-c7047573e5c239accf9e.js"/><link as="script" rel="preload" href="/baja/cb1608f2-054445c79c06534b5035.js"/><link as="script" rel="preload" href="/baja/app-506270a00a3559d88775.js"/><link as="script" rel="preload" href="/baja/a9a7754c-8d57bce12b88a78cd7d6.js"/><link as="script" rel="preload" href="/baja/0816e0feb973c1d40069d6902f99c49c22995b76-bedc1d1846d5a3c8be55.js"/><link as="script" rel="preload" href="/baja/component---src-templates-mdx-pages-js-3ceb1fe9d635f65ff425.js"/><link as="fetch" rel="preload" href="/baja/page-data/modules/2/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/baja/page-data/sq/d/1858702104.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/baja/page-data/sq/d/2153498299.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/baja/page-data/sq/d/3028011774.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/baja/page-data/sq/d/3458129946.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/baja/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="master"><header class="header "><nav class="navbar "><a class="navbar__brand" href="/baja/">Backend Java</a><button class="navbar__toggler" type="button" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar__toggler__icon"></span></button><div class="navbar__menu " id="navbarSupportedContent"><ul class="navbar__menu__list"><li class="navbar__menu__list__item"><a aria-current="page" class="navbar__menu__list__item__link" href="/baja/">Home</a></li><li class="navbar__menu__list__item"><a class="navbar__menu__list__item__link navbar__menu__list__item__link--dropdown-toggle">Contenu du cours</a><ul class="navbar__menu__list__item__dropdown-menu " aria-labelledby="navbarDropdown"><li class="navbar__menu__list__item__dropdown-menu__item"><a aria-current="page" class="navbar__menu__list__item__dropdown-menu__item__link" href="/baja/intro">Introduction</a></li><li class="navbar__menu__list__item__dropdown-menu__item"><a aria-current="page" class="navbar__menu__list__item__dropdown-menu__item__link" href="/baja/modules/1">Module 1 : découverte de JAX-RS</a></li><li class="navbar__menu__list__item__dropdown-menu__item"><a aria-current="page" class="navbar__menu__list__item__dropdown-menu__item__link" href="/baja/modules/2">Module 2 : JAX-RS &amp; auths</a></li><li class="navbar__menu__list__item__dropdown-menu__item"><a aria-current="page" class="navbar__menu__list__item__dropdown-menu__item__link" href="/baja/modules/3">Module 3 : JAX-RS avancé</a></li></ul></li><li class="navbar__menu__list__item"><a aria-current="page" class="navbar__menu__list__item__link" href="/baja/repositories">Repositories</a></li><li class="navbar__menu__list__item"><a aria-current="page" class="navbar__menu__list__item__link" href="/baja/about">About</a></li></ul></div></nav></header><main class="main"><div class="page page--auto-margin"><h1>Module 2 : JAX-RS &amp; auths</h1><p>Ce module vous offre le refactor d&#x27;une application JAX-RS tout en mettant en oeuvre le mécanisme
d&#x27;authentification et d&#x27;autorisation d&#x27;accès aux opérations. </p><p>Voici les sujets traités :</p><ul><li>a) <a href="/baja/modules/2#sectionA">Refactor d&#x27;une application JAX-RS</a></li><li>b) <a href="/baja/modules/2#sectionB">Configuration de l&#x27;application via un fichier .properties</a></li><li>c) <a href="/baja/modules/2#sectionC">Rappel de conventions sur les RESTful APIs, authentification &amp; autorisation</a></li><li>d) <a href="/baja/modules/2#sectionD">Authentification &amp; création de token JWT</a></li><li>e) <a href="/baja/modules/2#sectionE">Utilisation de jbcrypt pour gérer les passwords</a></li><li>f) <a href="/baja/modules/2#sectionF">Autorisation JWT, filtres, providers &amp; &quot;Name binding&quot;</a></li><li>g) <a href="/baja/modules/2#sectionG">Envoi de requêtes à ses APIs</a></li><li>h) <a href="/baja/modules/2#sectionH">Gestion des requêtes contenant des objets JSON quelconques</a></li><li>i) <a href="/baja/modules/2#sectionI">Gestion des réponses et sérialisation d&#x27;objets JSON quelconques</a></li><li>j) <a href="/baja/modules/2#sectionJ">Exercice 2.1</a></li></ul><br/><h1><a id="sectionA"></a>a) Refactor d&#x27;une application JAX-RS</h1><h2>a.1) Refactor général</h2><p>Dans le Module 1, nous avons développé ensemble une RESTful API permettant de gérer des films.</p><p>Nous allons maintenant faire un refactor de cette application afin de mieux architecturer le code.
Voici les motivations pour réarchitecturer l&#x27;API :</p><ol><li>Souhait de ne pas mixer le code associé à la présentation des ressources, c&#x27;est-à-dire le code s&#x27;occupant des réponses aux requêtes clients, au code associé à la gestion des données ;
on veut pouvoir mettre à jour la couche d&#x27;accès aux données sans devoir mettre à jour les Root Ressources.</li><li>La partie business de l&#x27;application, en d&#x27;autres mots la logique d&#x27;accès aux opérations sur les données, ne doit pas être séparée de la gestion des données.</li><li>On veut pouvoir rapidement distinguer certaines parties de code : les objets du domaine, le main, les opérations offertes sur les ressources, les utilitaires, la logique d&#x27;accès aux opérations sur les données et la gestion des données.</li></ol><br/><p>Pour ce faire, veuillez créer ces packages au sein de votre API gérant les films :</p><ul><li><strong>api</strong> : s&#x27;occupera des Root Resources et donc de la présentation des ressources aux clients.</li><li><strong>domain</strong> : inclura tous les objets du domaines, les sacs de données.</li><li><strong>main</strong> : gère le démarrage de l&#x27;application JAX-RS.</li><li><strong>services</strong> : permet de traiter de la logique d&#x27;accès aux opérations sur les données et la gestion de
ces données.</li><li><strong>utils</strong> : traite des morceaux de code réutilisables sur potentiellement toutes les applications
JAX-RS (gestion de la config par exemple).</li></ul><br/><p>Veuillez déplacer vos classes dans les bons packages.
La classe <strong>Json</strong> est à reprendre actuellement au sein du package <strong>services</strong>.</p><br/><p>Au sein du package <strong>services</strong>, veuillez créer une nouvelle classe <strong>FilmDataService</strong> qui
s&#x27;occupera de la logique et de l&#x27;accès aux données en faisant appel aux méthodes de la classe <strong>Json</strong>.
Voici le code de <strong>FilmDataService</strong> :</p><pre><code class="language-java">package be.vinci.services;

import be.vinci.domain.Film;
import jakarta.ws.rs.*;
import jakarta.ws.rs.core.MediaType;
import jakarta.ws.rs.core.Response;
import org.apache.commons.text.StringEscapeUtils;

import java.util.List;

public class FilmDataService {
    public List&lt;Film&gt; getAll(int minimumDuration) {
        var films = Json.parse();
        if (minimumDuration != -1) {
            List&lt;Film&gt; filmsFiltered = films.stream().filter(film -&gt; film.getDuration() &gt;= minimumDuration)
                    .toList();
            return filmsFiltered;
        }
        return films;
    }


    public Film getOne(int id) {
        var films = Json.parse();
        Film filmFound = films.stream().filter(film -&gt; film.getId() == id).findAny().orElse(null);
        return filmFound;
    }

    public Film createOne(Film film) {
        var films = Json.parse();
        film.setId(nextFilmId());
        film.setTitle(StringEscapeUtils.escapeHtml4(film.getTitle()));
        film.setLink(StringEscapeUtils.escapeHtml4(film.getLink()));
        films.add(film);
        Json.serialize(films);
        return film;
    }


    public Film deleteOne(int id) {
        var films = Json.parse();
        Film filmToDelete = films.stream().filter(film -&gt; film.getId() == id).findAny().orElse(null);
        films.remove(filmToDelete);
        Json.serialize(films);
        return filmToDelete;
    }

    public Film updateOne(Film film, int id) {
        var films = Json.parse();
        Film filmToUpdate = films.stream().filter(f -&gt; f.getId() == id).findAny().orElse(null);
        film.setId(id);
        film.setTitle(StringEscapeUtils.escapeHtml4(film.getTitle()));
        film.setLink(StringEscapeUtils.escapeHtml4(film.getLink()));
        films.remove(film); // thanks to equals(), films is found via its id
        films.add(film);
        Json.serialize(films);
        return film;
    }

    public int nextFilmId() {
        var films = Json.parse();
        if (films.size() == 0)
            return 1;
        return films.get(films.size() - 1).getId() + 1;
    }
}

</code></pre><br/><p>Dans le <strong>Main</strong>, faites en sorte de découvrir les ressources que dans le package <strong>api</strong> :</p><pre><code class="language-java" metastring="{1}">final ResourceConfig rc = new ResourceConfig().packages(&quot;be.vinci.api&quot;);
</code></pre><br/><p>Dans <strong>FilmResource</strong>, créez une instance de <strong>FilmDataService</strong> et faites appel aux méthodes offertes par vos services :</p><pre><code class="language-java" metastring="numbered {5,10,18,32,42,57}">@Singleton
@Path(&quot;films&quot;)
public class FilmResource {

    private FilmDataService myFilmDataService = new FilmDataService();

    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public List&lt;Film&gt; getAll(@DefaultValue(&quot;-1&quot;) @QueryParam(&quot;minimum-duration&quot;) int minimumDuration) {
        return myFilmDataService.getAll(minimumDuration);
    }


    @GET
    @Path(&quot;/{id}&quot;)
    @Produces(MediaType.APPLICATION_JSON)
    public Film getOne(@PathParam(&quot;id&quot;) int id) {
        Film filmFound = myFilmDataService.getOne(id);
        if (filmFound == null)
            throw new WebApplicationException(Response.status(Response.Status.NOT_FOUND)
                    .entity(&quot;Ressource not found&quot;).type(&quot;text/plain&quot;).build());
        return filmFound;
    }

    @POST
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    public Film createOne(Film film) {
        if (film == null || film.getTitle() == null || film.getTitle().isBlank())
            throw new WebApplicationException(
                    Response.status(Response.Status.BAD_REQUEST).entity(&quot;Lacks of mandatory info&quot;).type(&quot;text/plain&quot;).build());
        return myFilmDataService.createOne(film);
    }

    @DELETE
    @Path(&quot;/{id}&quot;)
    @Produces(MediaType.APPLICATION_JSON)
    public Film deleteOne(@PathParam(&quot;id&quot;) int id) {
        if (id == 0) // default value of an integer =&gt; has not been initialized
            throw new WebApplicationException(Response.status(Response.Status.BAD_REQUEST).entity(&quot;Lacks of mandatory id info&quot;)
                    .type(&quot;text/plain&quot;).build());
        Film deletedFilm = myFilmDataService.deleteOne(id);
        if (deletedFilm == null)
            throw new WebApplicationException(Response.status(Response.Status.NOT_FOUND)
                    .entity(&quot;Ressource not found&quot;).type(&quot;text/plain&quot;).build());
        return deletedFilm;
    }

    @PUT
    @Path(&quot;/{id}&quot;)
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    public Film updateOne(Film film, @PathParam(&quot;id&quot;) int id) {
        if (id == 0 || film == null || film.getTitle() == null || film.getTitle().isBlank())
            throw new WebApplicationException(
                    Response.status(Response.Status.BAD_REQUEST).entity(&quot;Lacks of mandatory info&quot;).type(&quot;text/plain&quot;).build());
        Film updatedFilm = myFilmDataService.updateOne(film, id);
        if (updatedFilm == null)
            throw new WebApplicationException(Response.status(Response.Status.NOT_FOUND)
                    .entity(&quot;Ressource not found&quot;).type(&quot;text/plain&quot;).build());
        return updatedFilm;
    }
}
</code></pre><br/><p>Veuillez exécuter et tester l&#x27;application pour vous assurer que celle-ci rende le même service
que précédemment.</p><br/><h2>a.2) Création d&#x27;un utilitaire utile pour tous les services de données</h2><p>La classe <strong>Json</strong> actuellement ne parse que des données vers le type <strong>Film</strong>.</p><p>Or on souhaiterait pouvoir charger n&#x27;importe quelle collection de données (pour n&#x27;importe quel type de ressources : des films, des textes...) et écrire cela pour retourner une <strong><code>List&lt;T&gt;</code></strong> (une liste paramétrée vers le type passé à la classe générique <strong>Json</strong>) :</p><pre><code class="language-java">return jsonMapper.readerForListOf(type).readValue(collection);
</code></pre><br/><p>On aimerait donc faire en sorte que <strong>type</strong>, dans le code donné ci-dessus, valent le type
passé à une classe générique. Ca serait en fait le type <strong>T</strong> passé à la classe <strong><code>Json&lt;T&gt;</code></strong>. La difficulté pour y arriver, c&#x27;est que les &quot;generics&quot; en Java
sont principalement déterminés à la compilation. Cela signifie que l&#x27;information est perdue à
l&#x27;exécution (le type paramétré <strong>T</strong> est un <strong>Object</strong>).
Pour obtenir l&#x27;information associé au type passé à la classe générique, lors de l&#x27;exécution,
il faut ajouter un argument à une fonction.</p><p>Ici, on a choisi d&#x27;ajouter le type au constructeur.</p><p>Veuillez créer le package <strong>utils</strong> au sein du package <strong>services</strong>.<br/>
<!-- -->Voici le code mis à jour de la classe <strong>Json</strong> pour la rendre générique afin de la paramétrer sur base du type associé aux ressources : </p><pre><code class="language-java" metastring="numbered {1,6,10-12,15,41,49,51,53,56}">public class Json&lt;T&gt; {

    private static final String DB_FILE_PATH = &quot;db.json&quot;;
    private static Path pathToDb = Paths.get(DB_FILE_PATH);
    private final static ObjectMapper jsonMapper = new ObjectMapper();
    private Class&lt;T&gt; type ;

    // Java generics are mostly compile time, this means that the type information is lost at runtime.
    // To get the type information at runtime you have to add it as an argument of the constructor.
    public Json(Class&lt;T&gt; type){
        this.type = type;
    }


    public void serialize(List&lt;T&gt; items, String collectionName) {
        try {
            // if no DB file, write a new collection to a new db file
            if (!Files.exists(pathToDb)) {
                // Create an object and add a JSON array as POJO, e.g. { items:[...]}
                ObjectNode newCollection = jsonMapper.createObjectNode().putPOJO(collectionName, items);
                jsonMapper.writeValue(pathToDb.toFile(), newCollection); // write the JSON Object in the DB file
                return;
            }
            // get all collections : can be read as generic JsonNode, if it can be Object or Array;
            JsonNode allCollections = jsonMapper.readTree(pathToDb.toFile()); // e.g. { users:[...], items:[...]}
            // remove current collection, e.g. remove the array of items
            if (allCollections.has(collectionName)) {
                ((ObjectNode) allCollections).remove(collectionName); //e.g. it leaves { users:[...]}
            }
            // Prepare a JSON array from the list of POJOs for the collection to be updated, e.g. [{&quot;film1&quot;,...}, ...]
            ArrayNode updatedCollection = jsonMapper.valueToTree(items);
            // Add the JSON array in allCollections, e.g. : { users:[...], items:[...]}
            ((ObjectNode) allCollections).putArray(collectionName).addAll(updatedCollection);
            // write to the db file allCollections
            jsonMapper.writeValue(pathToDb.toFile(), allCollections);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public List&lt;T&gt; parse(String collectionName) {
        try {
            // get allCollections
            JsonNode node = jsonMapper.readTree(pathToDb.toFile());
            // accessing value of the specified field of an object node,
            // e.g. the JSON array within &quot;items&quot; field of { users:[...], items:[...]}
            JsonNode collection = node.get(collectionName);
            if (collection == null) // Send an empty list if there is not the requested collection
                return (List&lt;T&gt;) new ArrayList&lt;T&gt;();
            // convert the JsonNode to a List of POJOs &amp; return it
            return jsonMapper.readerForListOf(type).readValue(collection);
        } catch (FileNotFoundException e) {
            return (List&lt;T&gt;) new ArrayList&lt;T&gt;(); // send an empty list if there is no db file
        } catch (IOException e) {
            e.printStackTrace();
            return (List&lt;T&gt;) new ArrayList&lt;T&gt;();
        }
    }

}
</code></pre><br/><p>Il faut aussi mettre à jour <strong>FilmDataService</strong> afin de paramétrer l&#x27;appel aux méthodes de la
classe <strong>Json</strong> :</p><pre><code class="language-java" metastring="numbered {3-4,8,20,26,31,37,40,45,52,57}">public class FilmDataService {

  private static final String COLLECTION_NAME = &quot;films&quot;;
  private static Json&lt;Film&gt; jsonDB = new Json&lt;&gt;(Film.class);


  public List&lt;Film&gt; getAll(int minimumDuration) {
    var films = jsonDB.parse(COLLECTION_NAME);
    if (minimumDuration != -1) {
      List&lt;Film&gt; filmsFiltered = films.stream()
          .filter(film -&gt; film.getDuration() &gt;= minimumDuration)
          .toList();
      return filmsFiltered;
    }
    return films;
  }


  public Film getOne(int id) {
    var films = jsonDB.parse(COLLECTION_NAME);
    Film filmFound = films.stream().filter(film -&gt; film.getId() == id).findAny().orElse(null);
    return filmFound;
  }

  public Film createOne(Film film) {
    var films = jsonDB.parse(COLLECTION_NAME);
    film.setId(nextFilmId());
    film.setTitle(StringEscapeUtils.escapeHtml4(film.getTitle()));
    film.setLink(StringEscapeUtils.escapeHtml4(film.getLink()));
    films.add(film);
    jsonDB.serialize(films, COLLECTION_NAME);
    return film;
  }


  public Film deleteOne(int id) {
    var films = jsonDB.parse(COLLECTION_NAME);
    Film filmToDelete = films.stream().filter(film -&gt; film.getId() == id).findAny().orElse(null);
    films.remove(filmToDelete);
    jsonDB.serialize(films, COLLECTION_NAME);
    return filmToDelete;
  }

  public Film updateOne(Film film, int id) {
    var films = jsonDB.parse(COLLECTION_NAME);
    Film filmToUpdate = films.stream().filter(f -&gt; f.getId() == id).findAny().orElse(null);
    film.setId(id);
    film.setTitle(StringEscapeUtils.escapeHtml4(film.getTitle()));
    film.setLink(StringEscapeUtils.escapeHtml4(film.getLink()));
    films.remove(film); // thanks to equals(), films is found via its id
    films.add(film);
    jsonDB.serialize(films, COLLECTION_NAME);
    return film;
  }

  public int nextFilmId() {
    var films = jsonDB.parse(COLLECTION_NAME);
      if (films.size() == 0) {
          return 1;
      }
    return films.get(films.size() - 1).getId() + 1;
  }
}
</code></pre><br/><p>Veuillez exécuter et tester votre application JAX-RS pour vous assurer que celle-ci est bien
fonctionnelle.</p><br/><h1><a id="sectionB"></a>b) Configuration de l&#x27;application via un fichier .properties</h1><p>Une bonne pratique est de rendre configurable son application Java via un fichier <strong>.properties</strong>.</p><p>Nous allons rendre cela possible en modifiant notre API de gestion de films.
Veuillez créer la classe <strong>Config</strong> dans le package <strong>utils</strong> : </p><pre><code class="language-java">package be.vinci.utils;

import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.Properties;

import jakarta.ws.rs.WebApplicationException;
import jakarta.ws.rs.core.Response;
import jakarta.ws.rs.core.Response.Status;

public class Config {

    private static Properties props;

    public static void load(String file) {
        props = new Properties();
        try (InputStream input = new FileInputStream(file)) {
            props.load(input);
        } catch (IOException e) {
            throw new WebApplicationException(
                    Response.status(Status.INTERNAL_SERVER_ERROR).entity(e.getMessage()).type(&quot;text/plain&quot;).build());
        }
    }

    public static String getProperty(String key) {
        return props.getProperty(key);
    }

    public static Integer getIntProperty(String key) {
        return Integer.parseInt(props.getProperty(key));
    }

    public static boolean getBoolProperty(String key) {
        return Boolean.parseBoolean(props.getProperty(key));
    }

}
</code></pre><br/><p>Cette classe <strong>Config</strong> permet de charger toutes les paramètres de configuration de l&#x27;application.</p><br/><p>Les paramètres de configuration de l&#x27;application, ou propriétés, sont à ajouter manuellement
dans un fichier <strong>.properties</strong>. Ce fichier contient des propriétés sous forme de <strong>key=value</strong>,
comme par exemple l&#x27;URL du serveur intégré à l&#x27;application JAX-RS.</p><p>Veuillez ajouter le fichier <strong>dev.properties</strong> à la racine de votre projet :</p><pre><code>BaseUri=http://localhost:8080/
DatabaseFilePath=db.json
</code></pre><br/><p>Pour que les propriétés soient disponibles dans tout le programme, le chargement des propriétés
se trouvant dans le fichier <strong>/dev.properties</strong> se fait dans le <strong>Main</strong>, au début de l&#x27;exécution
de la méthode <strong>main</strong>, ou même avant l&#x27;exécution de cette méthode.
Vous pourriez ajouter cette ligne dans la fonction <strong>main</strong>, avant de créer le serveur Http :</p><pre><code class="language-java">Config.load(&quot;dev.properties&quot;);
</code></pre><br/><p>Mais nous vous proposons d&#x27;utiliser un initialiseur &quot;static&quot; qui sera appelé avant la méthode
<strong>main</strong>. Veuillez mettre à jour votre classe <strong>Main</strong> en ajoutant :</p><pre><code class="language-java" metastring="{2-4}">public class Main {
    static{
        Config.load(&quot;dev.properties&quot;);
    }
</code></pre><br/><p>L&#x27;utilisation d&#x27;une propriété, comme par exemple l&#x27;URL du serveur intégré à l&#x27;application JAX-RS,
se fait via l&#x27;appel de <strong>getProperty</strong> de <strong>Config</strong> (ou <strong>getIntProperty</strong> ou <strong>getBoolProperty</strong>). </p><p>Veuillez mettre à jour la classe <strong>Main</strong> :</p><pre><code class="language-java" metastring="{6}">public class Main {
    static{
        Config.load(&quot;dev.properties&quot;);
    }
    // Base URI the Grizzly HTTP server will listen on
    public static final String BASE_URI = Config.getProperty(&quot;BaseUri&quot;);
</code></pre><br/><p>Veuillez aussi mettre à jour la classe <strong>Json</strong> pour utiliser la propriété associée au chemin
vers le fichier <strong>db.json</strong> :</p><pre><code class="language-java" metastring="{2}">public class Json&lt;T&gt; {
    private static final String DB_FILE_PATH = Config.getProperty(&quot;DatabaseFilePath&quot;);
</code></pre><br/><h1><a id="sectionC"></a>c) Rappel de conventions sur les RESTful APIs, authentification &amp; autorisation</h1><h2>c.1) Conventions sur les RESTful APIs</h2><p>Pour rappel, un RESTful web service, ou RESTful API, met à disposition des opérations
sur des ressources. Ces opérations seront disponibles via des requêtes http associées à des
URLs construites selon les conventions RESTful.</p><br/><p>Certaines opérations sont protégées par des tokens JWT.
Ainsi, tout client souhaitant accéder à ces opérations devra fournir un token dans le header
de la requête.
Le client devra donc mémoriser le token reçu lors de son enregistrement (<strong>auths/register</strong>) ou
lors de son login (<strong>auths/login</strong>) afin de le fournir à chaque requête vers une opération
protégée.</p><p>Voici les tableaux formalisant toutes les opérations associées à la RESTful API permettant de gérer
des films :</p><br/><h5>Tableau 1 : opérations sur les ressources de type &quot;Authentification&quot;</h5><table><thead><tr><th>URI</th><th>Méthode HTTP</th><th>Auths?</th><th>Opération</th></tr></thead><tbody><tr><td><strong>auths/login</strong></td><td>POST</td><td>Non</td><td>Vérifier les « credentials » d&#x27;un User et renvoyer le User et un token JWT s&#x27;ils sont OK</td></tr><tr><td><strong>auths/register</strong></td><td>POST</td><td>Non</td><td>Créer une ressource User et un token JWT et les renvoyer</td></tr></tbody></table><br/><h5>Tableau 2 : opérations sur les ressources de type &quot;Film&quot;</h5><table><thead><tr><th>URI</th><th>Méthode HTTP</th><th>Auths?</th><th>Opération</th></tr></thead><tbody><tr><td><strong>films</strong></td><td>GET</td><td>Non</td><td>READ ALL : Lire toutes les ressources de la collection</td></tr><tr><td><strong>films?minimumduration=value</strong></td><td>GET</td><td>Non</td><td>READ ALL FILTERED : Lire toutes les ressources de la collection selon le filtre donné</td></tr><tr><td><strong>films/{id}</strong></td><td>GET</td><td>Non</td><td>READ ONE : Lire la ressource identifiée</td></tr><tr><td><strong>films</strong></td><td>POST</td><td>JWT</td><td>CREATE ONE : Créer une ressource basée sur les données de la requête</td></tr><tr><td><strong>films/{id}</strong></td><td>DELETE</td><td>JWT</td><td>DELETE ONE : Effacer la ressource identifiée</td></tr><tr><td><strong>films/{id}</strong></td><td>PUT</td><td>JWT</td><td>UPDATE ONE : Replacer l&#x27;entièreté de la ressource par les données de la requête</td></tr></tbody></table><br/><h2>c.2) JWT authentification et autorisation : concepts généraux</h2><p>Les JWT sont parfaits pour la création de RESTful APIs, car ils permettent de mettre en place
un mécanisme d&#x27;authentification et autorisation « stateless » pour le backend.</p><br/><p>Le client va s&#x27;authentifier et donc obtenir un JWT généré par l&#x27;API lors de son enregistrement
(<strong>auths/register</strong>) ou lors de son login (<strong>auths/login</strong>).</p><p>Le JWT généré par l&#x27;API contient 3 parties :</p><ul><li>Un <strong>header</strong> : il est encodé en base64 indiquant l&#x27;algorithme de la signature du token.</li><li>Un <strong>payload</strong> : il est encodé en base64, il contient généralement des données permettant
d&#x27;identifier l&#x27;utilisateur faisant la requête. Ces données ne sont pas secrètes
(le payload n&#x27;est pas crypté !)</li><li>Une <strong>signature</strong> : elle est hachée selon l&#x27;algorithme spécifié dans le header.
La signature permet de vérifier que le token n&#x27;a pas été modifié, et donc,
de mettre en place un mécanisme d&#x27;autorisation d&#x27;accès aux opérations d&#x27;une API.</li></ul><br/><p>Tout client souhaitant accéder à des opérations nécessitant une autorisation via JWT devra fournir
un JWT dans le header de sa requête.
Pour ce faire, le client mémorisera généralement le JWT reçu lors de son authentification.
Typiquement, le JWT reçu par un client est enregistré dans le Web Storage de son browser ou dans un cookie.</p><br/><h1><a id="sectionD"></a>d) Authentification et création de token JWT</h1><h2>d.1) Ajout de la dépendance java-jwt</h2><p>Tant pour la création que la vérification d&#x27;un token, nous utiliserons la librairie java-jwt :
<a href="https://github.com/auth0/java-jwt">https://github.com/auth0/java-jwt</a></p><p>Pour utiliser cette librairie, ajoutez une dépendance à <strong>java-jwt</strong> :</p><ul><li>Via IntelliJ : <ul><li>cliquez au sein de votre fichier <strong>pom.xml</strong> : <strong>Code</strong>, <strong>Generate...</strong>, <strong>Dependency</strong></li><li>tapez : <strong>java-jwt</strong></li><li>Installez les dépendances Maven en cliquant sur le bouton représentant &quot;<strong>Load Maven Changes</strong>&quot;</li><li>NB : si IntelliJ ne trouve pas votre dépendance, et que le numéro de version est mis en rouge dans <strong>pom.xml</strong>, vous pouvez probablement résoudre cela en faisant un clic droit sur votre
<strong>pom.xml</strong>, <strong>Maven</strong>, <strong>Reload project</strong>.</li></ul></li><li>Si vous n&#x27;avez pas IntelliJ, ajoutez cela au sein de <strong>pom.xml</strong> puis forcer l&#x27;installation des dépendances :</li></ul><pre><code class="language-markup">&lt;dependency&gt;
            &lt;groupId&gt;com.auth0&lt;/groupId&gt;
            &lt;artifactId&gt;java-jwt&lt;/artifactId&gt;
            &lt;version&gt;4.4.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><br/><h2>d.2) Création du token JWT</h2><h3>d.2.1) Introduction</h3><p>Un token JWT doit être créé lors de l&#x27;authentification d&#x27;un utilisateur, au login ou à
l&#x27;enregistrement de celui-ci.</p><p>Nous allons donc créer les opérations <strong>login</strong> et <strong>register</strong> pour des ressources de type <strong>User</strong>.</p><br/><p>Pour ce faire, voici les étapes que nous allons suivre :</p><ul><li>Ajout d&#x27;une propriété pour gérer le secret associé à la signature des tokens.</li><li>Création d&#x27;une classe <strong>User</strong> qui va permettre de sérialiser les données du monde Java vers
le monde JSON.</li><li>Création d&#x27;une classe <strong>UserDataService</strong> qui va permettre de gérer les données associées aux
utilisateurs et qui va offrir les services d&#x27;accès aux données et la logique pour le <strong>login</strong>
et le <strong>register</strong>.</li><li>Création d&#x27;une Root Resource <strong>AuthsResource</strong> qui va s&#x27;occuper de gérer la présentation des
ressources (login &amp; register) aux clients.</li><li>Amélioration de la classe <strong>Json</strong> qui s&#x27;occupe de la persistance des données afin que l&#x27;on
puisse parser n&#x27;importe quelle collection de données. </li><li>Test des opérations de <strong>login</strong> et <strong>register</strong>.</li></ul><br/><h3>d.2.2) Propriété associée au secret utilisé pour la signature</h3><p>Veuillez ajouter le secret permettant de signer les token au sein de votre fichier <strong>dev.properties</strong> :</p><pre><code class="language-text" metastring="{3}">BaseUri=http://localhost:8080/
DatabaseFilePath=db.json
JWTSecret=ilovefilms
</code></pre><br/><h3>d.2.3) Création des objets du domaine</h3><p>Veuillez ajouter la classe <strong>User</strong> au package <strong>domain</strong> :</p><pre><code class="language-java">package be.vinci.domain;

public class User {

    private int id;

    private String login;

    private String password;

    public String getLogin() {
        return login;
    }

    public void setLogin(String login) {
        this.login = login;
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public boolean checkPassword(String password) {
        return this.password.equals(password);
    }

    @Override
    public String toString() {
        return &quot;{id:&quot; + id + &quot;, login:&quot; + login + &quot;, password:&quot; + password + &quot;}&quot;;
    }

}
</code></pre><br/><h3>d.2.4) Création du service de données associé aux utilisateurs</h3><p>Nous souhaitons créer une classe <strong>UserDataService</strong> qui va permettre :</p><ul><li>de gérer les données associées aux utilisateurs ;</li><li>d&#x27;offrir les cas d&#x27;utilisation <strong>login</strong> et <strong>register</strong>.</li></ul><br/><p>Veuillez ajouter cette classe dans le package <strong>services</strong> :</p><pre><code class="language-java" metastring="numbered {16,57-58,84-85}">package be.vinci.services;

import be.vinci.domain.User;
import be.vinci.services.utils.Json;
import be.vinci.utils.Config;
import com.auth0.jwt.JWT;
import com.auth0.jwt.algorithms.Algorithm;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ObjectNode;

import java.util.List;

public class UserDataService {
    private static final String COLLECTION_NAME = &quot;users&quot;;
    private static Json&lt;User&gt; jsonDB = new Json&lt;&gt;(User.class);
    private final Algorithm jwtAlgorithm = Algorithm.HMAC256(Config.getProperty(&quot;JWTSecret&quot;));
    private final ObjectMapper jsonMapper = new ObjectMapper();


    public List&lt;User&gt; getAll() {
        var items = jsonDB.parse(COLLECTION_NAME);
        return items;
    }


    public User getOne(int id) {
        var items = jsonDB.parse(COLLECTION_NAME);
        return items.stream().filter(item -&gt; item.getId() == id).findAny().orElse(null);
    }

    public User getOne(String login) {
        var items = jsonDB.parse(COLLECTION_NAME);
        return items.stream().filter(item -&gt; item.getLogin().equals(login)).findAny().orElse(null);
    }

    public User createOne(User item) {
        var items = jsonDB.parse(COLLECTION_NAME);
        item.setId(nextItemId());
        items.add(item);
        jsonDB.serialize(items, COLLECTION_NAME);
        return item;
    }

    public int nextItemId() {
        var items = jsonDB.parse(COLLECTION_NAME);
        if (items.size() == 0)
            return 1;
        return items.get(items.size() - 1).getId() + 1;
    }

    public ObjectNode login(String login, String password) {
        User user = getOne(login);
        if (user == null || !user.checkPassword(password))
            return null;
        String token;
        try {
            token = JWT.create().withIssuer(&quot;auth0&quot;)
                    .withClaim(&quot;user&quot;, user.getId()).sign(this.jwtAlgorithm);
            ObjectNode publicUser = jsonMapper.createObjectNode()
                    .put(&quot;token&quot;, token)
                    .put(&quot;id&quot;, user.getId())
                    .put(&quot;login&quot;, user.getLogin());
            return publicUser;

        } catch (Exception e) {
            System.out.println(&quot;Unable to create token&quot;);
            return null;
        }
    }

    public ObjectNode register(String login, String password) {
        User tempUser = getOne(login);
        if (tempUser != null) // the user already exists !
            return null;
        tempUser = new User();
        tempUser.setLogin(login);
        tempUser.setPassword(password);

        User user = createOne(tempUser);
        if (user == null)
            return null;
        String token;
        try {
            token = JWT.create().withIssuer(&quot;auth0&quot;)
                    .withClaim(&quot;user&quot;, user.getId()).sign(this.jwtAlgorithm);
            ObjectNode publicUser = jsonMapper.createObjectNode()
                    .put(&quot;token&quot;, token)
                    .put(&quot;id&quot;, user.getId())
                    .put(&quot;login&quot;, user.getLogin());
            return publicUser;

        } catch (Exception e) {
            System.out.println(&quot;Unable to create token&quot;);
            return null;
        }
    }

}
</code></pre><br/><p>Voici quelques explications concernant les token (d&#x27;autres explications portant sur les paramètres
de requête et la préparation des réponses seront données plus tard) :</p><ul><li>ligne 16 : on configure l&#x27;algorithme qui sera utilisé pour la signature du token sur base du
secret se trouvant dans <strong>dev.properties</strong></li><li>lignes 57-58 &amp; 84-85 : on génère un token et l&#x27;on ajoute juste l&#x27;<strong>id</strong> de l&#x27;utilisateur
dans le payload.</li></ul><br/><h3>d.2.4) Création de la Root Resource &quot;User&quot;</h3><p>Veuillez ajouter cette classe dans le package <strong>api</strong> :</p><pre><code class="language-java">package be.vinci.api;

import be.vinci.services.UserDataService;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.node.ObjectNode;
import jakarta.inject.Singleton;
import jakarta.ws.rs.*;
import jakarta.ws.rs.core.MediaType;
import jakarta.ws.rs.core.Response;

@Singleton
@Path(&quot;/auths&quot;)
public class AuthsResource {

    private UserDataService myUserDataService = new UserDataService();

    @POST
    @Path(&quot;login&quot;)
    @Consumes(MediaType.APPLICATION_JSON)
    @Produces(MediaType.APPLICATION_JSON)
    public ObjectNode login(JsonNode json) {
        // Get and check credentials
        if (!json.hasNonNull(&quot;login&quot;) || !json.hasNonNull(&quot;password&quot;)) {
            throw new WebApplicationException(Response.status(Response.Status.BAD_REQUEST)
                    .entity(&quot;login or password required&quot;).type(&quot;text/plain&quot;).build());
        }
        String login = json.get(&quot;login&quot;).asText();
        String password = json.get(&quot;password&quot;).asText();

        // Try to login
        ObjectNode publicUser = myUserDataService.login(login, password);
        if (publicUser == null) {
            throw new WebApplicationException(Response.status(Response.Status.UNAUTHORIZED)
                    .entity(&quot;Login or password incorrect&quot;).type(MediaType.TEXT_PLAIN)
                    .build());
        }
        return publicUser;

    }

    @POST
    @Path(&quot;register&quot;)
    @Consumes(MediaType.APPLICATION_JSON)
    @Produces(MediaType.APPLICATION_JSON)
    public ObjectNode register(JsonNode json) {
        // Get and check credentials
        if (!json.hasNonNull(&quot;login&quot;) || !json.hasNonNull(&quot;password&quot;)) {
            throw new WebApplicationException(Response.status(Response.Status.BAD_REQUEST)
                    .entity(&quot;login or password required&quot;).type(&quot;text/plain&quot;).build());
        }
        String login = json.get(&quot;login&quot;).asText();
        String password = json.get(&quot;password&quot;).asText();

        // Try to login
        ObjectNode publicUser = myUserDataService.register(login, password);
        if (publicUser == null) {
            throw new WebApplicationException(Response.status(Response.Status.CONFLICT)
                    .entity(&quot;this resource already exists&quot;).type(MediaType.TEXT_PLAIN)
                    .build());
        }
        return publicUser;

    }

}
}
</code></pre><br/><p>Le service de données s&#x27;occupant des utilisateurs fournit, lors du login et du register, un <strong>ObjectNode</strong> qui contient l&#x27;id, le login et le token d&#x27;un utilisateur. </p><br/><h3>d.2.5) Test des opérations de login et de register</h3><p>Veuillez tester les deux nouvelles opérations ajoutées.
Pour ce faire, à l&#x27;aide d&#x27;InteliJ, ajoutez le fichier <strong>users.http</strong> à votre module ou
projet (dans le répertoire <strong>requests</strong> par exemple) avec ces requêtes :</p><pre><code class="language-http-requests">@baseUrl = http://localhost:8080

### Register one default user
POST {{baseUrl}}/auths/register
Content-Type: application/json

{
  &quot;login&quot;:&quot;james&quot;,
  &quot;password&quot;:&quot;password&quot;
}

### Login with default user credentials
POST {{baseUrl}}/auths/login
Content-Type: application/json

{
  &quot;login&quot;:&quot;james&quot;,
  &quot;password&quot;:&quot;password&quot;
}

### Register john
POST {{baseUrl}}/auths/register
Content-Type: application/json

{
  &quot;login&quot;:&quot;john&quot;,
  &quot;password&quot;:&quot;123&quot;
}

### Login with John credentials
POST {{baseUrl}}/auths/login
Content-Type: application/json

{
  &quot;login&quot;:&quot;john&quot;,
  &quot;password&quot;:&quot;123&quot;
}
</code></pre><br/><p>Il ne vous reste plus qu&#x27;à exécuter votre RESTful API et exécuter les requêtes pour voir que l&#x27;API vous renvoie bien des tokens.</p><br/><h1><a id="sectionE"></a>e) Utilisation de jbcrypt pour gérer les passwords</h1><p>Tant pour hasher un password que pour le vérifier, nous utiliserons la librairie jbcrype :
<a href="https://www.mindrot.org/projects/jBCrypt/">https://www.mindrot.org/projects/jBCrypt/</a></p><p>Pour utiliser cette librairie, ajoutez une dépendance à <strong>jbcrypt</strong> :</p><ul><li>Via IntelliJ : <ul><li>cliquez au sein de votre fichier <strong>pom.xml</strong> : <strong>Code</strong> (ou clic droit dans <strong>pom.xml</strong>), <strong>Generate...</strong>, <strong>Dependency</strong></li><li>tapez : <strong>jbcrypt</strong></li><li>Installez les dépendances Maven en cliquant sur le bouton représentant &quot;<strong>Load Maven Changes</strong>&quot;</li><li>NB : si IntelliJ ne trouve pas votre dépendance, et que le numéro de version est mis en rouge
dans <strong>pom.xml</strong>, vous pouvez probablement résoudre cela en faisant un clic droit sur votre
<strong>pom.xml</strong>, <strong>Maven</strong>, <strong>Reload project</strong>.</li></ul></li><li>Si vous n&#x27;avez pas IntelliJ, ajoutez cela au sein de <strong>pom.xml</strong> puis forcer l&#x27;installation des dépendances :</li></ul><pre><code class="language-markup">&lt;dependency&gt;
            &lt;groupId&gt;org.mindrot&lt;/groupId&gt;
            &lt;artifactId&gt;jbcrypt&lt;/artifactId&gt;
            &lt;version&gt;0.4&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><br/><p>Nous allons mettre à jour la classe <strong>User</strong> afin d&#x27;offrir la fonction <strong>hashPassword</strong> et mettre à jour la fonction <strong>checkPassword</strong> : </p><pre><code class="language-java">public boolean checkPassword(String password) {
    return BCrypt.checkpw(password, this.password);
}

public String hashPassword(String password) {
    return BCrypt.hashpw(password, BCrypt.gensalt());
}
</code></pre><br/><p>⚡ Attention, maintenant que nous utilisons les passwords hachés, il faut supprimer l&#x27;ancienne base
de donnée des utilisateurs. Vous devez soit effacer la collection <strong>users</strong> du fichier <strong>db.json</strong>,
soit vous pouvez aussi directement effacer le fichier <strong>db.json</strong>.</p><br/><p>Il ne reste plus qu&#x27;à modifier légérement <strong>UserDataService</strong> afin d&#x27;enregistrer les passwords
hachés : veuillez mettre à jour la ligne surlignée de la méthode <strong>register</strong> :</p><pre><code class="language-java" metastring="{7}">public ObjectNode register(String login, String password) {
        User tempUser = getOne(login);
        if (tempUser != null) // the user already exists !
            return null;
        tempUser = new User();
        tempUser.setLogin(login);
        tempUser.setPassword(tempUser.hashPassword(password));
</code></pre><br/><h1><a id="sectionF"></a>f) Autorisation JWT, filtres, providers &amp; &quot;Name binding&quot;</h1><h2>f.1) Vérification d&#x27;un token : concepts généraux</h2><p>La vérification d&#x27;un token n&#x27;est nécessaire que pour les opérations sur les ressources
qui doivent être protégées (ou autorisées).</p><p>Le code générique pour vérifier un token est donné ici :
<a href="https://github.com/auth0/java-jwt#verify-a-token">https://github.com/auth0/java-jwt#verify-a-token</a>.</p><br/><p>Il serait peu intéressant de devoir réimplémenter ce code pour chaque opération nécessitant
une autorisation JWT.</p><br/><p>Ce que nous souhaitons, c&#x27;est :</p><ul><li>Pouvoir annoter chaque méthode d&#x27;une Root Resource devant être autorisée par JWT :
nous choisissons l&#x27;annotation <strong>@Authorize</strong> pour notre API de gestion de films ;</li><li>Appeler le morceau de code s&#x27;occupant de vérifier un JWT pour chaque méthode annotée de <strong>@Authorize</strong> :<ul><li>si le JWT reçu au sein du header de la requête est OK, nous nous occupons de charger
l&#x27;utilisateur ayant fait la requête dans un container associé à la requête du client,
via la clé &quot;user&quot; ; ensuite, le code de la méthode annotée par <strong>@Authorize</strong> est exécuté ;</li><li>si le JWT reçu au sein du header n&#x27;est pas vérifié avec succès, nous envoyons un code
d&#x27;erreur au client ; le code de la méthode annotée par <strong>@Authorize</strong> ne sera donc pas exécuté.</li></ul></li></ul><br/><p>NB : Pour certains d&#x27;entre vous, cela pourrait vous rappellera la création et l&#x27;utilisation
d&#x27;un middleware « authorize » dans le monde de Node.js / Express.</p><br/><p>Au sein d&#x27;une application JAX-RS, les filtres « serveurs » permettent de modifier
les requêtes ou les réponses, soit pour toutes les requêtes, soit pour seulement certaines
méthodes… </p><p>La suite fournit un résumé de comment mettre en place un filtre « serveur » pour toutes
les méthodes contenant une annotation personnelle, <strong>@Authorize</strong> dans la démo.</p><br/><h2>f.2) Filtres, providers &amp; « Name binding »</h2><p>Il est possible de créer toutes sortes de filtres pour modifier soit les requêtes,
soit les réponses d&#x27;une application JAX-RS. </p><br/><p>Si vous souhaitez des détails en plus du résumé présenté par la suite, les filtres sont expliqués dans le manuel de Jersey :
<a href="https://eclipse-ee4j.github.io/jersey.github.io/documentation/latest31x/filters-and-interceptors.html">https://eclipse-ee4j.github.io/jersey.github.io/documentation/latest31x/filters-and-interceptors.html</a></p><br/><p>Les filtres « serveurs » sont illustré au sein de cette section via la mise en place
d&#x27;un filtre de requêtes permettant principalement de filtrer toutes les requêtes qui
ne seraient pas autorisées (lorsque le JWT reçu n&#x27;est pas valide).</p><br/><p>Afin d&#x27;exécuter le traitement d&#x27;autorisation JWT pour chaque méthode annotée de <strong>@Authorize</strong>,
nous allons utiliser un objet de type « filtre de requête » qui hérite de <strong>ContainerRequestFilter</strong>.</p><br/><p>Veuillez ajouter un package <strong>filters</strong> au sein du package <strong>api</strong> et y créer la classe
<strong>AuthorizationRequestFilter</strong> :</p><pre><code class="language-java">package be.vinci.api.filters;

import java.io.IOException;

import be.vinci.domain.User;
import be.vinci.services.UserDataService;
import be.vinci.utils.Config;
import com.auth0.jwt.JWT;
import com.auth0.jwt.algorithms.Algorithm;
import com.auth0.jwt.interfaces.DecodedJWT;
import com.auth0.jwt.interfaces.JWTVerifier;
import jakarta.inject.Singleton;
import jakarta.ws.rs.WebApplicationException;
import jakarta.ws.rs.container.ContainerRequestContext;
import jakarta.ws.rs.container.ContainerRequestFilter;
import jakarta.ws.rs.core.Response;
import jakarta.ws.rs.core.Response.Status;
import jakarta.ws.rs.ext.Provider;

@Singleton
@Provider
@Authorize
public class AuthorizationRequestFilter implements ContainerRequestFilter {
    private final Algorithm jwtAlgorithm = Algorithm.HMAC256(Config.getProperty(&quot;JWTSecret&quot;));
    private final JWTVerifier jwtVerifier = JWT.require(this.jwtAlgorithm).withIssuer(&quot;auth0&quot;).build();
    private UserDataService myUserDataService = new UserDataService();

    @Override
    public void filter(ContainerRequestContext requestContext) throws IOException {
        String token = requestContext.getHeaderString(&quot;Authorization&quot;);
        if (token == null) {
            requestContext.abortWith(Response.status(Response.Status.UNAUTHORIZED)
                    .entity(&quot;A token is needed to access this resource&quot;).build());
        } else {
            DecodedJWT decodedToken = null;
            try {
                decodedToken = this.jwtVerifier.verify(token);
            } catch (Exception e) {
                throw new WebApplicationException(Response.status(Status.UNAUTHORIZED)
                        .entity(&quot;Malformed token : &quot; + e.getMessage()).type(&quot;text/plain&quot;).build());
            }
            User authenticatedUser = myUserDataService.getOne(decodedToken.getClaim(&quot;user&quot;).asInt());
            if (authenticatedUser == null) {
                requestContext.abortWith(Response.status(Status.FORBIDDEN)
                        .entity(&quot;You are forbidden to access this resource&quot;).build());
            }

            requestContext.setProperty(&quot;user&quot;, authenticatedUser);
        }
    }

}
</code></pre><br/><p><strong>AuthorizationRequestFilter</strong> va vérifier le JWT : </p><ul><li>S&#x27;il n&#x27;est pas OK, la requête est « avortée » en appelant <strong>abortWith</strong> et en
fournissant le code d&#x27;erreur ainsi qu&#x27;un message d&#x27;erreur au client. </li><li>Si le JWT est OK, le claim &quot;user&quot; mis dans le payload du JWT,
qui en fait est l&#x27;id de l&#x27;utilisateur, est utilisé pour ajouter l&#x27;utilisateur à la requête
( l&#x27;utilisateur est récupéré en faisant appel à la méthode <strong>getOne</strong> du service des données
des utilisateurs) sous la clé <strong>user</strong>.<br/>Ensuite, la méthode de la ressource annotée par <strong>@Authorize</strong> est exécutée, afin de préparer la réponse au client.</li></ul><br/><p>La notion de <strong>provider</strong> est définie dans la spécification de JAX-RS :
<a href="https://jakarta.ee/specifications/restful-ws/3.1/jakarta-restful-ws-spec-3.1#providers">https://jakarta.ee/specifications/restful-ws/3.1/jakarta-restful-ws-spec-3.1#providers</a>. </p><br/><p>En résumé, un <strong>provider</strong> permet de filtrer les requêtes, convertir des représentations
(XML, JSON…) vers des objets Java, mapper des exceptions à des réponses… </p><p>Il existe de nombreux providers prédéfinis qui sont fournis dans Jersey. </p><p>L&#x27;annotation <strong>@Provider</strong> permet de fournir notre propre implémentation d&#x27;un provider,
de la rendre disponible à l&#x27;exécution à notre application JAX-RS.</p><br/><p>Un filtre peut être lié à un nom, ce que l&#x27;on appelle « <strong>Name binding</strong> ». </p><p>A l&#x27;exécution d&#x27;une application JAX-RS, on pourra spécifier que le filtre sera exécuté
seulement pour certaines méthodes.</p><p>NB : les filtres peuvent ne pas être limités, on les appelle alors filtre globaux.</p><br/><p>Nous allons définir une annotation de type « <strong>Name binding</strong> » via <strong>@NameBinding</strong>.</p><p>Veuillez créer l&#x27;annotation <strong>Authorize</strong> au sein du package <strong>filters</strong> :</p><pre><code class="language-java">package be.vinci.api.filters;

import jakarta.ws.rs.NameBinding;

import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;

@NameBinding
@Retention(RetentionPolicy.RUNTIME)
public @interface Authorize {
}
</code></pre><br/><p>C&#x27;est grâce à cette annotation qui a été définie que <strong>AuthorizationRequestFilter</strong>
ne s&#x27;exécutera que pour les méthodes annotées de <strong>@Authorize</strong>.</p><br/><p>Au sein de <strong>FilmResource</strong>, il nous reste donc à annoter les opérations d&#x27;écriture de notre API de gestion de films afin de
les protéger par une autorisation JWT :</p><pre><code class="language-java" metastring="numbered {43,54,70}">package be.vinci.api;

import be.vinci.api.filters.Authorize;
import be.vinci.domain.Film;
import be.vinci.domain.User;
import be.vinci.services.FilmDataService;
import jakarta.inject.Singleton;
import jakarta.ws.rs.*;
import jakarta.ws.rs.core.Context;
import jakarta.ws.rs.core.MediaType;
import jakarta.ws.rs.core.Response;
import org.glassfish.jersey.server.ContainerRequest;

import java.util.List;

@Singleton
@Path(&quot;films&quot;)
public class FilmResource {

    private FilmDataService myFilmDataService = new FilmDataService();

    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public List&lt;Film&gt; getAll(@DefaultValue(&quot;-1&quot;) @QueryParam(&quot;minimum-duration&quot;) int minimumDuration) {
        return myFilmDataService.getAll(minimumDuration);
    }


    @GET
    @Path(&quot;/{id}&quot;)
    @Produces(MediaType.APPLICATION_JSON)
    public Film getOne(@PathParam(&quot;id&quot;) int id) {
        Film filmFound = myFilmDataService.getOne(id);
        if (filmFound == null)
            throw new WebApplicationException(Response.status(Response.Status.NOT_FOUND)
                    .entity(&quot;Ressource not found&quot;).type(&quot;text/plain&quot;).build());
        return filmFound;
    }

    @POST
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    @Authorize
    public Film createOne(Film film, @Context ContainerRequest request) {
        if (film == null || film.getTitle() == null || film.getTitle().isBlank())
            throw new WebApplicationException(
                    Response.status(Response.Status.BAD_REQUEST).entity(&quot;Lacks of mandatory info&quot;).type(&quot;text/plain&quot;).build());
        return myFilmDataService.createOne(film);
    }

    @DELETE
    @Path(&quot;/{id}&quot;)
    @Produces(MediaType.APPLICATION_JSON)
    @Authorize
    public Film deleteOne(@PathParam(&quot;id&quot;) int id) {
        if (id == 0) // default value of an integer =&gt; has not been initialized
            throw new WebApplicationException(Response.status(Response.Status.BAD_REQUEST).entity(&quot;Lacks of mandatory id info&quot;)
                    .type(&quot;text/plain&quot;).build());
        Film deletedFilm = myFilmDataService.deleteOne(id);
        if (deletedFilm == null)
            throw new WebApplicationException(Response.status(Response.Status.NOT_FOUND)
                    .entity(&quot;Ressource not found&quot;).type(&quot;text/plain&quot;).build());
        return deletedFilm;
    }

    @PUT
    @Path(&quot;/{id}&quot;)
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    @Authorize
    public Film updateOne(Film film, @PathParam(&quot;id&quot;) int id) {
        if (id == 0 || film == null || film.getTitle() == null || film.getTitle().isBlank())
            throw new WebApplicationException(
                    Response.status(Response.Status.BAD_REQUEST).entity(&quot;Lacks of mandatory info&quot;).type(&quot;text/plain&quot;).build());
        Film updatedFilm = myFilmDataService.updateOne(film, id);
        if (updatedFilm == null)
            throw new WebApplicationException(Response.status(Response.Status.NOT_FOUND)
                    .entity(&quot;Ressource not found&quot;).type(&quot;text/plain&quot;).build());
        return updatedFilm;
    }


}
</code></pre><br/><p>Comment peut-on récupérer l&#x27;objet <strong>user</strong> mis dans la requête par le
<strong>AuthorizationRequestFilter</strong> ?</p><br/><p>Voici un exemple en modifiant la méthode <strong>createOne</strong> de <strong>FilmResource</strong> :</p><pre><code class="language-java" metastring="{5-7}">@POST
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
@Authorize
public Film createOne(Film film, @Context ContainerRequest request) {
    User authenticatedUser = (User) request.getProperty(&quot;user&quot;);
    System.out.println(&quot;A new film is added by &quot; + authenticatedUser.getLogin() );
    if (film == null || film.getTitle() == null || film.getTitle().isBlank())
        throw new WebApplicationException(
                Response.status(Response.Status.BAD_REQUEST).entity(&quot;Lacks of mandatory info&quot;).type(&quot;text/plain&quot;).build());
    return myFilmDataService.createOne(film);
}
</code></pre><br/><p>C&#x27;est l&#x27;appel de <strong>getProperty</strong> sur un <strong>ContainerRequest</strong> qui permet de récupérer
l&#x27;objet préparé lors du traitement d&#x27;autorisation JWT (fait dans le filtre).</p><br/><p>💭  Pourquoi ajouter de l&#x27;information au sein d&#x27;une requête ?<br/>
<!-- -->Imaginez faire un appel à une base de donnée lorsque vous voulez vérifier qu&#x27;un utilisateur est bien authentifié, grâce à votre filtre. Une fois le code du filtre exécuté, vous aller réaliser l&#x27;opération demandée par le client. Il se peut que cette opération nécessite les données de l&#x27;utilisateur authentifié. Allez vous à nouveau faire un appel à la base de données ? Hé bien non, vous économisez cet appel à la base de données car les données de l&#x27;utilisateur authentifié sont disponibles dans le contexte de la requête.</p><br/><h1><a id="sectionG"></a>g) Envoi des requêtes à son API et JWT</h1><h2>g.1) Test de son API avec JWT</h2><p>Dans le cadre de ce cours, vous ne devez pas développer de frontend (par exemple en HTML /
JavaScript / CSS) pour tester vos APIs. Cela prendrait trop de temps. </p><p>Nous utilisons donc des clients légers permettant de faire des requêtes à nos APIs.</p><p>Comme nous vous encourageons à utiliser IntelliJ pour développer votre code Java, il est probablement
plus aisé de rester au sein du même environnement de développement en utilisant le client HTTP
d&#x27;IntelliJ.</p><br/><h2>g.2) HTTP Client d&#x27;IntelliJ avec des JWT</h2><p>IntelliJ permet d&#x27;ajouter des scripts associés aux réponses de cette façon :</p><pre><code class="language-text">GET host/api/test

&gt; {%
// Response Handler Script
...
%}
</code></pre><br/><p>Les scripts gérant les réponses aux requêtes peuvent accéder à deux objets :</p><ul><li><strong>client</strong> : permet d&#x27;enregistrer des données de session dans <strong>client.global</strong>.
Chaque variable que l&#x27;on sauve dans <strong>client.global</strong> en tant que <strong>variable_name</strong>,
en appelant la méthode <strong>set</strong>, sera accessible dans les requêtes futures via <strong>{{variable_name}}</strong>.</li><li><strong>response</strong> : contient les infos de la réponse à la requête (type, status, body...)</li></ul><br/><p>Voici le code permettant de tester l&#x27;API de gestion des films :</p><pre><code class="language-text">@baseUrl = http://localhost:8080 

### Read All films
GET {{baseUrl}}/films

### Login the default user
POST {{baseUrl}}/auths/login
Content-Type: application/json

{
  &quot;login&quot;:&quot;james&quot;,
  &quot;password&quot;:&quot;password&quot;
}

&gt; {%
client.global.set(&quot;jamesToken&quot;, response.body.token);
%}


### Create One film
POST {{baseUrl}}/films
Content-Type: application/json
Authorization: {{jamesToken}}

{
  &quot;title&quot;: &quot;Venom: Let There Be Carnage&quot;,
  &quot;duration&quot;: 9,
  &quot;budget&quot;: 110,
  &quot;link&quot;: &quot;https://en.wikipedia.org/wiki/Venom:_Let_There_Be_Carnage&quot;
}

### Delete One film
DELETE {{baseUrl}}/films/5
Authorization: {{jamesToken}}

### Update One film
PUT {{baseUrl}}/films/4
Content-Type: application/json
Authorization: {{jamesToken}}

{
  &quot;title&quot;: &quot;Venom: Let There Be Carnage&quot;,
  &quot;duration&quot;: 97,
  &quot;budget&quot;: 110,
  &quot;link&quot;: &quot;https://en.wikipedia.org/wiki/Venom:_Let_There_Be_Carnage&quot;
}

### Create One film with dangerous characters
POST {{baseUrl}}/films
Content-Type: application/json
Authorization: {{jamesToken}}

{
  &quot;title&quot;: &quot;&lt;img src=\&quot;#\&quot; onerror=\&quot;alert(&#x27;You have been hacked !&#x27;)\&quot;&gt;&quot;,
  &quot;duration&quot;: 9,
  &quot;budget&quot;: 110,
  &quot;link&quot;: &quot;https://en.wikipedia.org/wiki/Venom:_Let_There_Be_Carnage&quot;
}
</code></pre><br/><p>Plus d&#x27;information sur la gestion des réponses aux requêtes via le client HTTP d&#x27;IntelliJ :
<a href="https://www.jetbrains.com/help/idea/http-client-in-product-code-editor.html#using-response-handler-scripts">https://www.jetbrains.com/help/idea/http-client-in-product-code-editor.html#using-response-handler-scripts</a></p><br/><h2>g.3) REST Client sous VS Code &amp; JWT</h2><p>Quelques notions pour utiliser REST Client avec des JWT :</p><ul><li>Il est possible de créer des « <strong>Request Variables</strong> » afin de récupérer la réponse associée
à une requête au sein d&#x27;une variable.</li><li>On va donc pouvoir récupérer le token, suite à une requête d&#x27;authentification,
au sein d&#x27;une « <strong>Request Variable</strong> », pour ensuite fournir ce token dans le
« <strong>Authorization header</strong> » de toutes les requêtes demandant une autorisation JWT.</li></ul><br/><p>Voici le script permettant de tester les opérations sur les films :</p><pre><code class="language-http-requests">@baseUrl = http://localhost:8080

### Login the default user &amp; define a Request Variable
# @name james
POST {{baseUrl}}/auths/login
Content-Type: application/json

{
  &quot;login&quot;:&quot;james&quot;,
  &quot;password&quot;:&quot;password&quot;
}
### get the james&#x27; token in a File Variable
@jamesToken = {{james.response.body.token}}

### Create One film
POST {{baseUrl}}/films
Content-Type: application/json
Authorization: {{jamesToken}}

{
  &quot;title&quot; : &quot;Venom: Let There Be Carnage&quot;,
  &quot;duration&quot; : 97,
  &quot;budget&quot; : 110,
  &quot;link&quot; : &quot;https://en.wikipedia.org/wiki/Venom:_Let_There_Be_Carnage&quot;
}

### Read All films
GET {{baseUrl}}/films

### Delete One film
DELETE {{baseUrl}}/films/5
Authorization: {{admin.response.body.token}}

### Update One film
PUT {{baseUrl}}/films/4
Content-Type: application/json
Authorization: {{jamesToken}}

{
  &quot;title&quot; : &quot;Venom: Let There Be Carnage&quot;,
  &quot;duration&quot; : 97,
  &quot;budget&quot; : 110,
  &quot;link&quot; : &quot;https://en.wikipedia.org/wiki/Venom:_Let_There_Be_Carnage&quot;
}
</code></pre><br/><p>Plus de détails sur REST Client et ses fonctionnalités :
<a href="https://github.com/Huachao/vscode-restclient">https://github.com/Huachao/vscode-restclient</a></p><br/><h1><a id="sectionH"></a>h) Gestion des requêtes contenant des objets JSON quelconques</h1><h2>h.1) Introduction</h2><p>Dans le cadre du module 1, nous avons vu les moyens principaux de gérer des requêtes. </p><p>Pour ce module-ci, nous avons été en contact avec du code permettant :</p><ul><li>de récupérer des informations JSON du body d&#x27;une requête sans passer par un POJO,
mais en utilisant un <strong>JsonNode</strong>. </li><li>de retrouver le contexte d&#x27;une requête.<br/></li></ul><p>Nous allons maintenant expliquer les concepts associés.</p><br/><h2>h.2) Récupération des paramètres d&#x27;une requête d&#x27;un objet quelconque</h2><p>Nous allons souvent souhaiter récupérer des données qui ont été envoyées au format JSON au sein du body d&#x27;une requête client.</p><br/><p>Dans le cas où ces données ne correspondent pas à un POJO, nous pouvons utiliser
un paramètre de type <strong>JsonNode</strong>, et récupérer les champs JSON via la méthode <strong>get</strong>.</p><br/><p>Admettons qu&#x27;une requête cliente envoie ce JSON : </p><pre><code class="language-json">{
    &quot;login&quot;:&quot;james&quot;,
    &quot;password&quot;:&quot;password&quot;
}
</code></pre><br/><p>La méthode <strong>login</strong> de la classe <strong>AuthsResource</strong> permet de récupérer cet objet JSON
et de le parser au sein de l&#x27;argument <strong>json</strong> :</p><pre><code class="language-java" metastring="{5,11-12}">@POST
@Path(&quot;login&quot;)
@Consumes(MediaType.APPLICATION_JSON)
@Produces(MediaType.APPLICATION_JSON)
public ObjectNode login(JsonNode json) {
    // Get and check credentials
    if (!json.hasNonNull(&quot;login&quot;) || !json.hasNonNull(&quot;password&quot;)) {
        throw new WebApplicationException(Response.status(Response.Status.BAD_REQUEST)
                .entity(&quot;login or password required&quot;).type(&quot;text/plain&quot;).build());
    }
    String login = json.get(&quot;login&quot;).asText();
    String password = json.get(&quot;password&quot;).asText();
</code></pre><br/><p>Il ne faut pas oublier de préciser le type MIME de la requête qui sera consommée
par la méthode, ici : <strong>@Consumes(MediaType.APPLICATION_JSON)</strong>.</p><br/><p>NB : Tout cela est possible car la librairie <strong>Jackson</strong> est bien chargée au sein de
notre application JAX-RS.</p><br/><h2>h.3) Contexte et @Context</h2><p>JAX-RS fournit un moyen simple de bénéficier d&#x27;informations associées au contexte du
déploiement d&#x27;une application et du contexte de requêtes individuelles. </p><p>Ces informations sont disponibles pour les sous-classes d&#x27;<strong>Application</strong>, <strong>Root Resource Classes</strong> et les <strong>providers</strong>. C&#x27;est l&#x27;annotation <strong>@Context</strong> qui permet, par exemple, d&#x27;injecter
un provider au sein d&#x27;une variable (argument d&#x27;une méthode ou champs d&#x27;une classe).</p><br/><p>Dans le code de la méthode <strong>createOne</strong> de <strong>FilmResource</strong>, c&#x27;est grâce à <strong>@Context</strong>
que l&#x27;on peut récupérer le contenu de la requête qui a été filtrée par
<strong>AuthorizationRequestFilter</strong> :</p><pre><code class="language-java" metastring="{5-6}">@POST
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
@Authorize
public Film createOne(Film film, @Context ContainerRequest request) {
    User authenticatedUser = (User) request.getProperty(&quot;user&quot;);
    System.out.println(&quot;A new film is added by &quot; + authenticatedUser.getLogin() );
</code></pre><br/><h1><a id="sectionI"></a>i) Gestion des réponses et sérialisation d&#x27;objets JSON quelconques</h1><h2>i.1) Introduction</h2><p>Dans le cadre du module 1, nous avons vu les moyens principaux de gérer des réponses.
Nous renvoyions toujours des POJOs ou des listes de POJOs. </p><p>Pour ce module-ci, nous avons été en contact avec du code permettant de sérialiser
des informations et les renvoyer au client sans devoir passer par un POJO,
mais en créant ses propres objets JSON.</p><br/><h2>i.2) Sérialiser et renvoyer des objets JSON quelconques</h2><p>Dans le cas où des données à renvoyer à un client ne correspondent pas à un POJO, nous pouvons créer en Java, à l&#x27;aide de librairie <strong>Jackson</strong>, du <strong>JSON</strong> via :</p><ul><li><strong>JsonNode</strong> si cela peut être la représentation d&#x27;un objet en JSON (<strong>ObjectNode</strong>)
ou d&#x27;un tableau en JSON (<strong>ArrayNode</strong>) ;</li><li><strong>ObjectNode</strong> pour la représentation d&#x27;un objet en JSON ;</li><li><strong>ArrayNode</strong>  pour la représentation d&#x27;un tableau en JSON.</li></ul><br/><p>Admettons que nous souhaitons construire une réponse JSON de ce type : </p><pre><code class="language-json">{
  &quot;token&quot;: &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJhdXRoMCIsInVzZXIiOjF9.JX5Xnp4KDvpkderjcv2W1TmCgwklKpRDIw3vheDSoNg&quot;,
  &quot;id&quot;: 1,
  &quot;login&quot;: &quot;james&quot;
}
</code></pre><br/><p>Dans la méthode <strong>login</strong> de la classe <strong>AuthsResource</strong>, voici le code permettant
de renvoyer une représentation JSON de cet objet via un <strong>ObjectNode</strong> :</p><pre><code class="language-java" metastring="numbered {6,16,22}">public class AuthsResource {
    //...
    @POST
    @Path(&quot;login&quot;)
    @Consumes(MediaType.APPLICATION_JSON)
    @Produces(MediaType.APPLICATION_JSON)
    public ObjectNode login(JsonNode json) {
        // Get and check credentials
        if (!json.hasNonNull(&quot;login&quot;) || !json.hasNonNull(&quot;password&quot;)) {
            throw new WebApplicationException(Response.status(Response.Status.BAD_REQUEST)
                    .entity(&quot;login or password required&quot;).type(&quot;text/plain&quot;).build());
        }
        String login = json.get(&quot;login&quot;).asText();
        String password = json.get(&quot;password&quot;).asText();
        // Try to login
        ObjectNode publicUser = myUserDataService.login(login, password);
        if (publicUser == null) {
            throw new WebApplicationException(Response.status(Response.Status.UNAUTHORIZED)
                    .entity(&quot;Login or password incorrect&quot;).type(MediaType.TEXT_PLAIN)
                    .build());
        }
        return publicUser;
    }
    //...
}
</code></pre><br/><p>C&#x27;est donc la méthode <strong>login</strong> de <strong>UserDataService</strong> qui crée la représentation JSON
d&#x27;un objet contenant un <strong>token</strong>, un <strong>id</strong> et un <strong>login</strong> comme propriétés.
Le code permettant de créer une représentation de cet objet JSON utilise un
<strong>ObjectMapper</strong> permettant de créer un <strong>ObjectNode</strong> :</p><pre><code class="language-java" metastring="numbered {3,13-17}">public class UserDataService {
    //...
    private final ObjectMapper jsonMapper = new ObjectMapper();
    //...
    public ObjectNode login(String login, String password) {
        User user = getOne(login);
        if (user == null || !user.checkPassword(password))
            return null;
        String token;
        try {
            token = JWT.create().withIssuer(&quot;auth0&quot;)
                    .withClaim(&quot;user&quot;, user.getId()).sign(this.jwtAlgorithm);
            ObjectNode publicUser = jsonMapper.createObjectNode()
                    .put(&quot;token&quot;, token)
                    .put(&quot;id&quot;, user.getId())
                    .put(&quot;login&quot;, user.getLogin());
            return publicUser;

        } catch (Exception e) {
            System.out.println(&quot;Unable to create token&quot;);
            return null;
        }
    }
    //...
}
</code></pre><br/><p>La méthode <strong>put</strong> permet d&#x27;ajouter des champs à un objet de type <strong>ObjecNode</strong>.
Nous pouvons ajouter autant de champs que nécessaire à l&#x27;objet JSON qui sera
sérialisé et renvoyé au client via une Root Resource (<strong>AuthsResource</strong> dans notre exemple).</p><br/><p><strong>Code du tutoriel</strong> : si vous souhaitez directement accéder au code de la fin du tutoriel de
création d&#x27;une API de gestion de films pour ce module 2 :
<a href="https://github.com/e-vinci/baja-demos/tree/main/films-api-tutorial2">https://github.com/e-vinci/baja-demos/tree/main/films-api-tutorial2</a></p><br/><h1><a id="sectionJ"></a>j) Exercice 2.1</h1><p>Peut-être avez-vous déjà entendu parler de cette mode montante dans le Web
qu&#x27;est la JAMstack ?</p><br/><p>Nous souhaitons développer un Headless CMS, c&#x27;est-à-dire un outil permettant
de créer du contenu, très souvent utilisé dans le cadre de sites JAMstack.</p><p>Un Headless CMS fournira une interface web pour créer du contenu (ou des données),
ainsi qu&#x27;une RESTful API mettant à disposition ce contenu.</p><br/><p>L&#x27;Headless CMS que nous souhaitons développer doit permettre de créer le contenu
associé à un blog.</p><p>Un blog sera structuré en pages. Une page aura un id, un titre, un URI, un contenu,
un auteur ainsi qu&#x27;un statut de publication.</p><p>Le statut de publication d&#x27;une page peut actuellement prendre comme valeur :</p><ul><li>« hidden »</li><li>« published »</li></ul><br/><p>Seul un utilisateur authentifié pourra lire, créer, modifier ou supprimer des pages.</p><br/><p>La modification d&#x27;une page, tout comme la suppression d&#x27;une page ne pourra se faire
que par son auteur.</p><br/><p>L&#x27;ajout ou la modification d&#x27;une page ne sera possible que si le statut de publication
donné correspond à un des deux statuts actuels (« hidden ou « published »).
Sinon un message d&#x27;erreur devra être renvoyé.</p><br/><p>La lecture d&#x27;une page, ou de toutes les pages, pourra être réalisée par n&#x27;importe
quel utilisateur authentifié pour les pages dont le statut vaut « published ».</p><br/><p>Pour les pages dont le statut vaut « hidden », seul leur auteur authentifié pourra les lire.</p><br/><p>Lorsque vous renvoyer les données associées à une page, il est acceptable, à ce stade-ci,
d&#x27;inclure le password dans la réponse faite au client. </p><br/><p>Il est aussi acceptable à ce stade-ci, lorsque vous devez renvoyer une erreur à un client, de simplement
renvoyer un code d&#x27;erreur (sans mettre de message dans le body de la réponse).</p><br/><p>Veuillez développer une application JAX-RS mettant à disposition les opérations
décrites ci-dessus.</p><br/><p>Dans un premier temps, veuillez formaliser les opérations associées à vos RESTful
APIs sous forme d&#x27;un tableau dans un fichier <strong>README.md</strong>. </p><p>Votre tableau doit reprendre les conventions REST présentées au point
<a href="/baja/modules/2#sectionC">c) Rappel de conventions sur les RESTful APIs, authentification &amp; autorisation</a>.</p><br/><p>Comment créer un tableau dans un fichier Markdown  ?
Deux options :</p><ul><li>Soit vous utiliser des &#x27;<strong>|</strong>&#x27; pour délimiter les cellules et des &#x27;<strong>|---|</strong>&#x27; pour séparer
les headers du corps du tableau.
Voici un exemple pour l&#x27;API de films :</li></ul><pre><code class="language-text">| URI | Méthode HTTP | Auths? | Opération |
|---|---|---|---|
| **films** | GET | Non | READ ALL : Lire toutes les ressources de la collection |
| **films?minimumduration=value** | GET | Non | READ ALL FILTERED : Lire toutes les ressources de la collection selon le filtre donné |
| **films/{id}** | GET | Non | READ ONE : Lire la ressource identifiée |
| **films** | POST | JWT | CREATE ONE : Créer une ressource basée sur les données de la requête |
| **films/{id}** | DELETE | JWT | DELETE ONE : Effacer la ressource identifiée |
| **films/{id}** | PUT | JWT | UPDATE ONE : Replacer l&#x27;entièreté de la ressource par les données de la requête |
</code></pre><ul><li>Soit c&#x27;est simplement un tableau HTML (<code>&lt;table&gt;</code>).</li></ul><br/><p>Lors de l&#x27;implémentation de vos RESTful APIs, veuillez tester toutes les
méthodes offertes par votre application JAX-RS à l&#x27;aide d&#x27;un client léger (HTTP client d&#x27;IntelliJ
ou Rest Client de VS Code).</p><br/><p>Les ressources doivent persister au format JSON et vous devez échapper les caractères dangereux.</p><br/><p>Veuillez partir d&#x27;un archetype Maven comme décrit au point
<a href="/baja/modules/1#sectionB">Module 1 : b) Création d&#x27;une première application sur base d&#x27;un Archetype Maven</a>.</p><p>Veuillez intégrer à votre application les fichiers utiles du tutoriel <a href="https://github.com/e-vinci/baja-demos/tree/main/films-api-tutorial2">https://github.com/e-vinci/baja-demos/tree/main/films-api-tutorial2</a> présentée dans ce module-ci, principalement : <strong>pom.xml</strong>, <strong>Authorize</strong>, <strong>AuthorizationRequestFilter</strong>, <strong>Config</strong>, <strong>AuthsResource</strong>, <strong>UserDataService</strong></p><br/><p>🍬 Optionnel : vous souhaitez rapidement découvrir les principes d&#x27;une architecture Web associée à la JAMstack ? <a href="https://jamstack.wtf/">https://jamstack.wtf/</a> </p><br/><p>🍬 Optionnel : si vous souhaitez découvrir le format Markdown, notamment très souvent utilisé dans certains sites JAMstack (source des données pour certains Headless CMS) :
<a href="https://www.markdownguide.org/basic-syntax/">https://www.markdownguide.org/basic-syntax/</a></p><br/><p><strong>🍬 Challenges</strong> : </p><ul><li><strong>N°1</strong> : Modifiez les autorisations au niveau des opérations de lecture (en gras pour la modification) :
la lecture d&#x27;une page, ou de toutes les pages, pourra être réalisée par n&#x27;importe
quel utilisateur <strong>anonyme ou authentifié</strong> pour les pages dont le statut vaut « published ».
Pour les pages dont le statut vaut « hidden », seul leur auteur authentifié pourra les lire.</li><li><strong>N°2</strong> : lorsqu&#x27;un utilisateur tente d&#x27;effacer ou modifier une page dont il n&#x27;est pas l&#x27;auteur,
renvoyer un code d&#x27;erreur approprié au client.</li><li><strong>N°3</strong> : Si vous ne l&#x27;avez pas déjà fait, trouvez une façon de ne pas inclure le password lors de la sérialisation de celui-ci dans une page (via l&#x27;auteur de la page). Attention, le password doit toujours être sérialisé lors de l&#x27;enregistrement d&#x27;un utilisateur.</li></ul><br/></div></main><footer class="footer "><div class="background footer__background"><div class="footer__logo"><h3 class="footer__logo__text">Backend Java</h3><div class="footer__logo__image"></div><div class="footer__logo__image2"></div></div><div class="footer__icons"><ul class="menu"><li><a href="mailto: raphael.baroni@vinci.be" data-email="raphael.baroni@vinci.be" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg></a></li></ul></div></div></footer><div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/modules/2/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-506270a00a3559d88775.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-510fdaa458a9d8e9affa.js"],"component---src-pages-404-js":["/component---src-pages-404-js-5428f57e2de053a196b3.js"],"component---src-pages-about-js":["/component---src-pages-about-js-4a647fe4cbb953fd2688.js"],"component---src-templates-mdx-pages-js":["/component---src-templates-mdx-pages-js-3ceb1fe9d635f65ff425.js"]};/*]]>*/</script><script src="/baja/component---src-templates-mdx-pages-js-3ceb1fe9d635f65ff425.js" async=""></script><script src="/baja/0816e0feb973c1d40069d6902f99c49c22995b76-bedc1d1846d5a3c8be55.js" async=""></script><script src="/baja/a9a7754c-8d57bce12b88a78cd7d6.js" async=""></script><script src="/baja/app-506270a00a3559d88775.js" async=""></script><script src="/baja/cb1608f2-054445c79c06534b5035.js" async=""></script><script src="/baja/framework-c7047573e5c239accf9e.js" async=""></script><script src="/baja/webpack-runtime-1a988f899203af32e814.js" async=""></script></body></html>